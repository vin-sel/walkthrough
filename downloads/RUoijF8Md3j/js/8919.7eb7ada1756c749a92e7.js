"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[8919],{22299:(t,e,i)=>{i.d(e,{J:()=>n});var s=i(92237),o=i(84710);class n extends o.B{constructor(){super(),this.name="cursor",this.opacity=new s.z(0),this.texture=null}}},44667:(t,e,i)=>{i.d(e,{s:()=>o});var s=i(92475);class o extends s.E{constructor(t,e,i){super(),this.position=t,this.delta=e,this.viewport=i}}},70497:(t,e,i)=>{var s;i.d(e,{X:()=>s}),function(t){t[t.Min=0]="Min",t[t.Standard=1]="Standard",t[t.High=2]="High",t[t.Detail=3]="Detail"}(s||(s={}))},32484:(t,e,i)=>{i.d(e,{yJ:()=>r});var s=i(80112),o=i(47299),n=i(14971);const r={TEXTURE_SETTINGS:o.Ay,TILEDMESH_SETTINGS:s.W,clearRaycastHits:n.Jn}},80112:(t,e,i)=>{i.d(e,{W:()=>r});var s=i(64491),o=i(75778),n=i(70497);const r={urlTemplateToken:"<file>",initialMaxLOD:n.X.Min,nonMeshMaxLOD:n.X.Standard,maxLOD:n.X.High,minLOD:n.X.Min,loadSiblings:!0,displayActiveTiles:!1,autoDisableRendererCulling:!0,optimizeRaycast:!1,stopAtEmptyTiles:!1,disableTileUpdates:!1,disposeModel:!1,limitMemoryUsage:(0,s.Fr)(),allocatedMegsBeforeLimitingLod:350,lruMinExtraTiles:(0,s.Fr)()?0:100,lruMaxTiles:800,lruUnloadPercent:.05,downloadQueueConcurrency:8,parseQueueConcurrency:10,snappingMaxLOD:n.X.Standard,errorTarget:Number((0,o.P3)("errorTarget",(0,s.Fr)()?6:4)),errorMultiplierHiddenFloors:.01,errorMultiplierRaycastOcclusion:.1,smallMeshThreshold:Number((0,o.P3)("smallMeshThreshold",40)),smallMeshErrorMultiplier:Number((0,o.P3)("smallMeshErrorMultiplier",.1))}},14971:(t,e,i)=>{i.d(e,{Jn:()=>d,rt:()=>h});var s=i(68909);const o=i(47299).Ay.sightingMaxAge,n=new s.Color;let r,a=-1;const h=(t,e,i)=>{r||(r=new s.InstancedMesh(new s.SphereGeometry(.005,8,4),new s.MeshBasicMaterial,o),r.frustumCulled=!1,l(r));const h=new s.Matrix4;return({point:s,distance:d})=>{const l=d/i.fovDistanceScale();h.makeScale(l,l,l).setPosition(s),r.setMatrixAt(++a%o,h),r.instanceMatrix.needsUpdate=!0;for(let e=o;e--;)r.setColorAt((a-e+o)%o,n.setHex(t).multiplyScalar(1-e/o));r.instanceColor&&(r.instanceColor.needsUpdate=!0),r.parent||e.scene.add(r)}},d=()=>{var t;r&&(null===(t=r.parent)||void 0===t||t.remove(r),l(r))};function l(t){const e=(new s.Matrix4).makeScale(0,0,0);for(let i=0;i<o;i++)t.setMatrixAt(i,e)}new s.Vector4(1,0,0,1),new s.Vector4(0,1,0,1),new s.Vector4(0,0,1,1),new s.Vector4(1,1,0,1),new s.Vector4(1,0,1,1),new s.Vector4(1,1,1,1),new s.Vector4(0,1,1,1),new s.Vector4(0,0,0,1)},41819:(t,e,i)=>{i.d(e,{H:()=>d});var s=i(79728),o=i(1333),n=i(81662),r=i(68909),a=i(2993),h=i(53172);class d{constructor(t,e,i,d,l,c){var u,p;this.options=t,this.settingsData=i,this.rotate=d,this.stopRotating=l,this.walkingPath=c,this.type=o.gX.Burns,this.toIndex=-1,this.started=-1,this.stopped=-1,this.duration=0,this.direction=o.ND.Auto,this.degrees=0,this.adjustedPanSpeed=0,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve();const{snapshot:m,nextSnapshot:g}=t,w=s.A.getPanValues(this.settingsData,!1,t.panOverrides);this.degrees=w.degrees,this.alignment=w.alignment,this.duration=null!==(u=t.duration)&&void 0!==u?u:w.ms,this.toIndex=e;const T=null!==(p=w.direction)&&void 0!==p?p:o.ND.Auto;let v=w.radiansPerMs;if(void 0!==T&&T!==o.ND.Auto)v*=T;else{const t=this.walkingPath.getValidWalkingPath(g,m.metadata.scanId);if(t&&t.length>1){const e=t[1].position.clone().sub(m.metadata.cameraPosition).normalize(),i=n.B1.FORWARD.clone().applyQuaternion(m.metadata.cameraQuaternion),s=Math.sign(i.cross(e).y);v=0!==s?v*s:v}else if(g&&m){if(!(0,a.nI)(m.metadata.cameraMode)&&(v=-v),m.metadata.scanId===g.metadata.scanId){const t=n.B1.FORWARD.clone().applyQuaternion(m.metadata.cameraQuaternion),e=n.B1.FORWARD.clone().applyQuaternion(g.metadata.cameraQuaternion),i=Math.sign(t.cross(e).y);v=0!==i?v*i:v}}}this.adjustedPanSpeed=v,this.direction=Math.sign(v),"center"===w.alignment&&(this.startPose={position:m.metadata.cameraPosition,rotation:(new r.Quaternion).setFromAxisAngle(n.B1.UP,(0,h.pu)(this.degrees/2)*-this.direction).multiply(m.metadata.cameraQuaternion),viewMode:m.metadata.cameraMode})}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null,this.stopped=Date.now())}start(){if(this.active)throw Error("Transition already active");const{options:t}=this;this.onStopRequested=async()=>{await this.stopRotating()};const e=t.nextSnapshot&&!(0,a.nI)(t.nextSnapshot.metadata.cameraMode),i=this.rotate(this.duration,new r.Vector2(this.adjustedPanSpeed,0),!e);return this.currentTransitionPromise=i.then((()=>{this.currentTransitionPromise=null,this.stopped=Date.now()})),this.started=Date.now(),this.stopped=-1,this}}},79728:(t,e,i)=>{i.d(e,{A:()=>H});var s=i(53172),o=i(86866),n=i(60152),r=i(88664),a=i(56208),h=i(90160),d=i(1333);class l{constructor(t=-1){this.active=!1,this.type=d.gX.Nop,this.promise=Promise.resolve(),this.stop=()=>Promise.resolve(),this.duration=0,this.started=-1,this.stopped=-1,this.toIndex=t}start(){return this}}var c=i(48539);class u{constructor(t,e){this.type=d.gX.Delay,this.toIndex=-1,this.started=-1,this.stopped=-1,this.duration=0,this.currentTransitionPromise=null,this.cancelDelay=()=>null,this.duration=t,this.toIndex=e}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(this.cancelDelay(),this.currentTransitionPromise=null,this.stopped=Date.now())}start(){if(this.active)throw Error("Transition already active");const t=(0,c.op)(this.duration);return this.cancelDelay=()=>{t.resolveEarly()},this.currentTransitionPromise=t.promise.then((()=>this.stop())),this.started=Date.now(),this.stopped=-1,this}}class p{constructor(t,e,i,s){this.zoom=i,this.stopZooming=s,this.type=d.gX.Zoom,this.toIndex=-1,this.started=-1,this.stopped=-1,this.duration=0,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve(),this.duration=t.duration,this.toIndex=e}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null,this.stopped=Date.now())}start(){if(this.active)throw Error("Transition already active");return this.currentTransitionPromise=this.zoom(this.duration,-5).then((()=>{this.currentTransitionPromise=null,this.stopped=Date.now()})),this.started=Date.now(),this.stopped=-1,this.onStopRequested=async()=>{await this.stopZooming()},this}}var m=i(79769),g=i(13893),w=i(68909),T=i(94814),v=i(31093),P=i(48734);const y=.001,D=(t,e,i,s)=>{const o=Math.max(.75,Math.min(t.distanceTo(e),5)),n=o*(1/s)*1e3;let r=n;const a=i/n;if(a>y){r+=r*((a-y)/y)}const h=Math.abs(t.clone().setX(0).setZ(0).distanceTo(e.clone().setX(0).setZ(0))/Math.max(o,1));if(h>.1){r*=.9+.75*h}return r};class f extends d.Tz{constructor(t,e,i,s,o,n,r){super(),this.options=t,this.settingsData=i,this.moveToSweep=s,this.updateTransitionSpeed=o,this.setRestrictedSweeps=n,this.generators=r,this.toIndex=-1,this.started=-1,this.stopped=-1,this.duration=0,this.currentGenerator=null,this.currentTransitionPromise=null,this.type=d.gX.Move,this.toIndex=e,this.sweeps=t.path.slice(0,2)}get active(){return null!==this.currentTransitionPromise||null!==this.currentGenerator}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null,this.stopped=Date.now()),this.currentGenerator&&(this.generators.stopGenerator(this.currentGenerator),this.currentGenerator=null)}calculateCurve(){const{sweeps:[{position:t},{position:e}]}=this,i=t.distanceTo(e);return{curve:new w.LineCurve3(t,e),totalLength:i,normalSourceDistances:[0,1],sourceDistances:[0,i]}}start(){if(this.active)throw Error("Transition already active");const{options:t}=this,{generator:e,deferred:i}=this.build(t.path,t.orientations);return this.generators.startGenerator(e),this.currentGenerator=e,this.currentTransitionPromise=i.nativePromise(),this.started=Date.now(),this.stopped=-1,this}build(t,e){const i=new v.i,s=this;let n=!1;return this.onStopRequested=async()=>{n=!0,await this.updateTransitionSpeed(m.FAST_FORWARD_FACTOR)},{generator:function*(){let r=1;const a=s.options.startPose.rotation.clone();for(;r<t.length&&!n;){const i=r-1,n=t[r],h=n.position,d=t[i],l=e[r],c=(0,o.HN)(a,l),u=H.getTransitionSpeed(s.settingsData),p=D(d.position,h,c,u),m={transitionType:g.fl.Interpolate,sweepId:n.id,rotation:l,transitionTime:p,easing:T.p9};s.duration=p,s.setRestrictedSweeps(t,i);const w=s.moveToSweep(m);yield new P.sv(w.nativePromise()),a.copy(l),r++}s.setRestrictedSweeps(null),i.resolve(),s.currentTransitionPromise=null,s.stop()},deferred:i}}}var S=i(39209);const M=new(i(10843).Ay)("tours");class I extends d.Tz{constructor(t,e,i,s,n,r,a,h,l,c){super(),this.options=t,this.cameraTransition=s,this.sweepTransition=n,this.sweepControl=r,this.cameraControl=a,this.generators=h,this.setRestrictedSweeps=l,this.getCurve=c,this.type=d.gX.Path,this.toIndex=-1,this.started=-1,this.stopped=-1,this.duration=0,this.speed=0,this.currentTransitionGenerator=null,this.currentTransitionPromise=null,this.canceling=!1,this.buildTransition=(t,e)=>{const i=this,s=new v.i;this.setRestrictedSweeps(t);const n=this.calculateCurve(),r=T.p9,a=T.rn,h=T.dV;i.cameraControl.beginExternalTransition();return{generator:function*(){s.notify(0);const d=new w.Vector3,l=new w.Quaternion;let c=0,u=0,p=0,T=1,v=t[T].id;yield new P.sv(i.sweepControl.activateSweepUnsafe({sweepId:v}).then((()=>{i.sweepControl.beginSweepTransition({sweepId:v,transitionTime:i.duration,internalProgress:!1})}))),t.length>2&&i.sweepControl.activateSweepUnsafe({sweepId:t[2].id});let y=i.options.startPose.rotation.clone();const f=i.options.startPose.position.clone();for(;c<i.duration&&!i.canceling;){const m=c/i.duration;p>0&&(y=e[p].clone());const g=e[T],w=n.normalSourceDistances[p],D=n.normalSourceDistances[T],S=t[T];if(u=(0,o.OF)(m,w,D,0,1),u<=1){const t=h(u,0,1,1);i.sweepTransition.progress.modifyAnimation(t,1,0);const e=a(u,0,1,1);l.copy(y).slerp(g,e)}m<1&&d.copy(n.curve.getPointAt(r(m,0,1,1))),i.cameraControl.updateCameraPosition(d),i.cameraControl.updateCameraRotation(l),m>=D&&(i.sweepControl.endSweepTransition({sweepId:S.id}),p++,T++,v=t[p+1].id,yield new P.sv(i.sweepControl.activateSweepUnsafe({sweepId:v}).then((()=>{i.sweepControl.beginSweepTransition({sweepId:v,transitionTime:i.duration,internalProgress:!1})}))),t.length>p+2&&i.sweepControl.activateSweepUnsafe({sweepId:t[p+2].id})),f.copy(d),s.notify(m),c=Date.now()-i.cameraTransition.startTime,yield new P.oN}if(i.cameraControl.endExternalTransition(),i.canceling){i.canceling=!1;const e=t[T].position,s=D(f,e,0,i.speed),n=i.cameraControl.moveTo({transitionTime:s/m.FAST_FORWARD_FACTOR,transitionType:g.fl.Interpolate,pose:{position:e}});n.progress((t=>{const e=(0,o.OF)(t,0,1,u,1);i.sweepTransition.progress.modifyAnimation(e,1,0)})),yield new P.sv(n.nativePromise())}i.sweepControl.endSweepTransition({sweepId:v}),i.setRestrictedSweeps(null),s.notify(1),s.resolve()},deferred:s}},this.toIndex=e,this.sweeps=t.path,this.speed=H.getTransitionSpeed(i),this.duration=((t,e,i)=>{let s=0;for(let n=0;n<t.length-1;n++){const r=(0,o.HN)(e[n],e[n+1]);s+=D(t[n].position,t[n+1].position,r,i)}return s})(t.path,t.orientations,this.speed),M.debug(`path duration: ${this.duration.toFixed(0)}ms, at speed: ${this.speed}m/s`)}get active(){return null!==this.currentTransitionPromise||null!==this.currentTransitionGenerator}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.canceling=!0,this.currentTransitionPromise&&(await this.promise,this.currentTransitionPromise=null,this.stopped=Date.now()),this.currentTransitionGenerator&&(this.generators.stopGenerator(this.currentTransitionGenerator),this.currentTransitionGenerator=null)}start(){const{options:t}=this;if(M.debug(`starting smooth transition with ${t.path.length-1} stops`),this.active)throw Error("Transition already active");this.canceling=!1;const{generator:e,deferred:i}=this.buildTransition(t.path,t.orientations);return this.generators.startGenerator(e),this.currentTransitionGenerator=e,this.currentTransitionPromise=i.nativePromise().then((()=>{this.currentTransitionPromise=null,this.currentTransitionGenerator=null,this.stopped=Date.now()})),this.started=Date.now(),this.stopped=-1,this}calculateCurve(){const t=this.options.path;if(t.length<=2)throw M.debug(`invalid path: ${t}`),new Error("smooth path requires more than 2 stops");const e=t.map((t=>t.position));return this.getCurve(e)}}var C=i(2993);class x{constructor(t,e,i,s,o,n,r,a){this.options=t,this.settingsData=i,this.cameraControl=s,this.sweepControl=o,this.switchToMode=n,this.setRestrictedSweeps=r,this.generators=a,this.toIndex=-1,this.started=-1,this.stopped=-1,this.duration=0,this.type=d.gX.Move,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve(),this.toIndex=e}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null,this.stopped=Date.now())}start(){if(this.active)throw Error("Transition already active");const t=this.options;if(!t.snapshot)return this.currentTransitionPromise=Promise.resolve(),this;const{deferred:e}=this.build(t.snapshot,t.currentSweep,t.transitionType);return this.currentTransitionPromise=e.then((()=>{this.currentTransitionPromise=null,this.stopped=Date.now()})),this.started=Date.now(),this.stopped=-1,this}build(t,e,i){var s,n,r;const{position:a,rotation:h,viewMode:d}=this.options.endPose;let l,c,u=Promise.resolve();if(t.metadata.scanId){const e=this.sweepControl.getSweepOnView(t.metadata.scanId,null!==(s=t.sourceViewId)&&void 0!==s?s:null);l=null==e?void 0:e.id,c=null==e?void 0:e.platformId}const p=(0,o.HN)(this.options.startPose.rotation,h),m=!t.is360,w={position:a,rotation:h,sweepID:l,zoom:t.metadata.orthoZoom};let T=H.getOtherModeTransitionTime(this.settingsData,p,i);const v=this.options.startPose.viewMode;if(d!==v||d===C.N3.Floorplan)u=this.switchToMode(d,i,w,T);else{if(!!l&&(0,C.nI)(v)){if(l){const s=e&&(null===(n=this.sweepControl.data.currentSweepObject)||void 0===n?void 0:n.platformId)===c,o=((null===(r=this.sweepControl.data.currentSweepObject)||void 0===r?void 0:r.sourceViewId)||null)!==(t.sourceViewId||null),a=!e||l!==e;s?(T=H.getSamePanoTransitionTime(this.settingsData,p),u=o?this.standardSweepMovePromise({rotation:w.rotation,targetSweepId:l,transitionTime:T,transitionType:g.fl.Interpolate,viewId:t.sourceViewId}):this.standardTransitionSameSweepRotationPromise(w.rotation,l,p,T,t.sourceViewId)):a&&(T=H.getTransitionTime(this.settingsData),u=t.is360?this.standardSweepMovePromise({rotation:w.rotation,targetSweepId:l,transitionTime:T,transitionType:i,viewId:t.sourceViewId}):this.standardTransitionSweepMovePromise(w,l,m,T))}}else u=this.cameraControl.moveTo({transitionType:i,pose:w,transitionTime:T}).nativePromise()}return!(0,C.nI)(d)&&l&&(u=u.then((()=>this.sweepControl.setCurrentSweep({sweepId:l})))),this.duration=null!=T?T:0,{deferred:u}}standardTransitionSameSweepRotationPromise(t,e,i,s,o){var n;return this.setRestrictedSweeps(null),(null===(n=this.sweepControl.data.currentSweepObject)||void 0===n?void 0:n.id)!==e?this.sweepControl.moveToSweep({sweepId:e,viewId:null!=o?o:null,transitionTime:s,transitionType:g.fl.Interpolate,rotation:t}).nativePromise():i<.01?Promise.resolve():this.cameraControl.moveTo({transitionType:g.fl.Interpolate,pose:{rotation:t},transitionTime:s}).nativePromise()}standardSweepMovePromise({rotation:t,targetSweepId:e,transitionTime:i,transitionType:s,viewId:o}){return this.sweepControl.moveToSweep({rotation:t,sweepId:e,transitionTime:i,transitionType:s,viewId:null!=o?o:null}).nativePromise()}standardTransitionSweepMovePromise(t,e,i,s){if(!t.position)throw Error("Push transition requires a position");const o=this.options.startPose.position,n=t.position.clone().sub(o).normalize(),r=o.clone().add(n.multiplyScalar(.15)),a=new v.i;this.setRestrictedSweeps(null);const h=this;return this.generators.startGenerator((function*(){yield new P.sv(h.sweepControl.activateSweepUnsafe({sweepId:e}));const n=new w.Vector3,d=Date.now();let l,c=0,u=!1,p=!1;for(;c<s;){const a=(0,T.Do)(c,0,c/s,s);i&&h.cameraControl.updateCameraPosition(n.copy(o).lerp(r,a)),a>=.3&&!p&&(l=h.cameraControl.moveTo({transitionType:g.fl.FadeToBlack,pose:t,transitionTime:s,blackoutTime:.5*s}).progress((t=>{t>=.5&&!u&&(h.sweepControl.instantSweepTransition(e),u=!0)})),p=!0),yield new P.oN,c=Date.now()-d}l&&(yield new P.sv(l.nativePromise())),a.resolve()})),a.nativePromise()}}class b{constructor(t,e,i,s,o){this.options=t,this.moveToSweep=i,this.cameraControl=s,this.switchToMode=o,this.toIndex=-1,this.started=-1,this.stopped=-1,this.duration=0,this.type=d.gX.Move,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve(),this.toIndex=e}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null,this.stopped=Date.now())}start(){if(this.active)throw Error("Transition already active");const{options:t}=this;if(!t.snapshot)return this.currentTransitionPromise=Promise.resolve(),this.started=Date.now(),this.stopped=Date.now(),this;const{deferred:e}=this.build(t.snapshot,t.startPose,t.endPose);return this.currentTransitionPromise=e.then((()=>{this.currentTransitionPromise=null,this.stopped=Date.now()})),this.started=Date.now(),this.stopped=-1,this}build(t,e,i){let s=Promise.resolve();const{position:o,rotation:n,viewMode:r}=i,a=t.metadata.scanId,h={position:o,rotation:n,sweepID:a,zoom:t.metadata.orthoZoom},d=r!==e.viewMode,l=!!a&&(0,C.nI)(e.viewMode);if(d)s=this.switchToMode(r,g.fl.Instant,h);else if(l){const t={transitionType:g.fl.Instant,sweepId:a,rotation:n};s=this.moveToSweep(t).nativePromise()}else s=this.cameraControl.moveTo({transitionType:g.fl.Instant,pose:h}).nativePromise();return{deferred:s}}}var R=i(72773),F=i(23272);class V{constructor(t,e,i,s){this.targetSnapshot=t,this.issueCommand=i,this.currentFloorId=s,this.type=d.gX.FloorChange,this.toIndex=-1,this.started=-1,this.stopped=-1,this.duration=R.t$,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve(),this.toIndex=e}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null,this.stopped=Date.now())}start(){if(this.active)throw Error("Transition already active");let t=Promise.resolve();const e=this.targetSnapshot.metadata.floorId,i=e!==this.currentFloorId(),s=this.targetSnapshot.metadata.cameraMode;return!(0,C.nI)(s)&&s!==C.N3.Outdoor&&i&&(t=this.issueCommand(new F.i1(e,!0,this.duration))),this.currentTransitionPromise=t.then((()=>{this.currentTransitionPromise=null,this.stopped=Date.now()})),this.started=Date.now(),this.stopped=-1,this}}var A=i(81662);class O{constructor(t,e,i,s,o){var n;this.options=t,this.settingsData=i,this.rotate=s,this.stopRotating=o,this.type=d.gX.Burns,this.toIndex=-1,this.started=-1,this.stopped=-1,this.duration=0,this.currentTransitionPromise=null,this.onStopRequested=()=>Promise.resolve(),this.toIndex=e,this.duration=null!==(n=t.duration)&&void 0!==n?n:H.getPanValues(this.settingsData,!0,t.panOverrides).ms}get active(){return null!==this.currentTransitionPromise}get promise(){return this.currentTransitionPromise?this.currentTransitionPromise:Promise.resolve()}async stop(){this.currentTransitionPromise&&(await this.onStopRequested(),await this.promise,this.currentTransitionPromise=null,this.stopped=Date.now())}start(){if(this.active)throw Error("Transition already active");const{options:t}=this;if(!t.snapshot||!t.nextSnapshot)return this.currentTransitionPromise=Promise.resolve(),this;const{deferred:e}=this.build(t.snapshot,t.nextSnapshot,t.panOverrides);return this.currentTransitionPromise=e.then((()=>{this.currentTransitionPromise=null,this.stopped=Date.now()})),this.started=Date.now(),this.stopped=-1,this}build(t,e,i){const s=H.getPanValues(this.settingsData,!0,i);let o=-1*s.radiansPerMs;const n=s.direction;if(void 0!==n&&n!==d.ND.Auto)o*=n;else if(t&&t.metadata.cameraQuaternion&&e&&e.metadata.cameraQuaternion){const i=A.B1.FORWARD.clone().applyQuaternion(t.metadata.cameraQuaternion),s=A.B1.FORWARD.clone().applyQuaternion(e.metadata.cameraQuaternion),n=Math.sign(i.cross(s).y);o=0!==n?o*n:o}this.onStopRequested=async()=>{await this.stopRotating()};return{deferred:this.rotate(this.duration,new w.Vector2(o,0))}}}var k=i(41819);const B={sharpTurnDotThreshold:.65,directionWeightFactorStd:.75,directionWeightFactorSharp:.2,positionalWeightFactorStd:.4,positionalWeightFactorSharp:.2,finalWalkingNodeDirectionWeight:5,lookAheadNodes:3};class G{constructor(t=B){this.settings=t}getOrientationsForPath(t,e){const i=[];for(let s=0;s<t.length;s++){const o=new w.Vector3;this.getLookVectorsForPathNode(t,s,e,o);const n=(new w.Matrix4).lookAt(t[s],o,A.B1.UP);i[s]=(new w.Quaternion).setFromRotationMatrix(n)}return i.push(e),i}getLookVectorsForPathNode(t,e,i,s){const o=new w.Vector3,n=new w.Vector3,r=new w.Vector3,a=new w.Vector3,h=t.length;if(e>=h)return!1;let d=1,l=1;const c=new w.Vector3;let u;for(let s=e;s<e+this.settings.lookAheadNodes&&s<h;s++){if(u=t[s],this.getOrientationForPathNode(t,s,i,r),s===e&&o.copy(r),s>e){const t=o.dot(r)<this.settings.sharpTurnDotThreshold;d*=t?this.settings.directionWeightFactorSharp:this.settings.directionWeightFactorStd,l*=t?this.settings.positionalWeightFactorSharp:this.settings.positionalWeightFactorStd}s===h-1&&(d=this.settings.finalWalkingNodeDirectionWeight,l=1),c.copy(r),r.multiplyScalar(d),n.add(r),a.lerp(u,l)}return n.normalize(),s.copy(a),s.add(n),!0}getOrientationForPathNode(t,e,i,s){if(e>=t.length)return!1;if(e===t.length-1)s.copy(A.B1.FORWARD).applyQuaternion(i);else{const i=t[e],o=t[e+1];s.copy(o).sub(i)}return s.normalize(),!0}}var N=i(71687);class E{constructor(t,e){this.sweepModule=t,this.pathModule=e,this.getValidWalkingPath=(t,e)=>{var i;void 0===e&&(e=null===(i=this.sweepModule.data.currentSweepObject)||void 0===i?void 0:i.id);const s=this.sweepModule.data.getSweep(e),o=this.sweepModule.data.getSweep(t.metadata.scanId);if(!(t.metadata.cameraMode===C.N3.Panorama&&s&&o&&s.platformId!==o.platformId&&s.isAligned()&&o.isAligned()&&s.enabled&&o.enabled))return null;const r=this.pathModule.findShortestPath(s.platformId,o.platformId,n.W0.maxSweepDistance,n.W0.maxDistanceBeforeAddingSweeps,n.W0.minSweepDistance,n.W0.maxSidestepDistance,n.W0.pathRadius,n.W0.maxTotalSteps)||[];return 0===r.length?null:t.sourceViewId||s.sourceViewId?r.map(((e,i)=>this.sweepModule.getSweepOnView(e.platformId,0===i?s.sourceViewId:t.sourceViewId))):r}}}var W=i(44481),L=i(35447);class H{constructor(t,e,i,s,o,n){this.engine=t,this.tourData=e,this.sweepModule=i,this.cameraData=s,this.settingsData=o,this.viewmodeData=n,this.init=async()=>{this.sweepData=this.sweepModule.data,this.cameraPoseController=await this.engine.getModuleBySymbol(N.jh),this.pathModule=await this.engine.getModuleBySymbol(N.Np),this.floorsViewData=await this.engine.market.waitForData(S.X),this.toursViewData=await this.engine.market.waitForData(W.F),this.commonControlsModule=await this.engine.getModuleBySymbol(N.X7),this.viewmodeModule=await this.engine.getModuleBySymbol(N.SD),this.pathOrientHelper=new G,this.setRestrictedSweeps=this.pathModule.setRestrictedSweeps.bind(this.pathModule),this.getCurveForPath=this.pathModule.getCurveForPath.bind(this.pathModule),this.moveToSweep=this.sweepModule.moveToSweep.bind(this.sweepModule),this.updateTransitionSpeed=this.cameraPoseController.updateTransitionSpeed.bind(this.cameraPoseController),this.switchToMode=this.viewmodeModule.switchToMode.bind(this.viewmodeModule),this.startRotateTransition=this.commonControlsModule.startRotateTransition.bind(this.commonControlsModule),this.stopCamera=this.commonControlsModule.stop.bind(this.commonControlsModule),this.startZoomTransition=this.commonControlsModule.startZoomTransition.bind(this.commonControlsModule),this.issueCommand=this.engine.commandBinder.issueCommand.bind(this.engine.commandBinder),this.walkingPath=new E(this.sweepModule,this.pathModule)}}static isDelayTransition(t,e,i){return!(0,n.ht)(t)||e!==d._y.Zoom&&0===H.getPanDegrees(t,i.panAngle)}getBurnsStyleForSnapshot(t){const{tourData:e}=this,i=e.getTourEntrySidFromIndex(t),s=e.getTourEntry(i),o=e.getHighlightsCount();if(!s||!s.snapshot)return d._y.None;if(t===o-1&&this.isStaticFinalStop(t))return this.toursViewData.getTourStoryMode()?d._y.Delay:d._y.None;const n=s.snapshot.metadata.cameraMode,r=n===C.N3.Dollhouse?d._y.PanDollhouse:n===C.N3.Floorplan?d._y.Zoom:d._y.Pan;return H.isDelayTransition(this.settingsData,r,s.overrides||{})?d._y.Delay:r}isStaticFinalStop(t){if(t<this.tourData.getHighlightsCount()-1)return!1;const{overrides:e}=this.tourData.getReel().reel.get(t),i=H.getPanDirection(this.settingsData,null==e?void 0:e.panDirection),s=H.getPanDegrees(this.settingsData,null==e?void 0:e.panAngle),o=this.tourData.getActiveReelTourMode(),n=(0,L.Kl)(this.settingsData,o);return 0===s||!n&&i===d.ND.Auto}static getPanDegrees(t,e){let i;return i=(0,n.ht)(t)?-1!==t.getOverrideParam(n.I5,-1)?(0,n.H1)(t):void 0!==e?e:t.tryGetProperty(a.Q$.PanAngle,n.V4):0,Math.max(i,0)}static getPanDirection(t,e){return void 0!==e?e:t.tryGetProperty(a.Q$.PanDirection,r.ek)}static getPanAlignment(t,e){return null!=e?e:"start"}static getDelayDuration(t){return-1!==t.getOverrideParam(n.R8,-1)||0===t.getOverrideParam(n.Yh,-1)?(0,n.Lh)(t):n.DE}static getZoomDuration(t){return-1!==t.getOverrideParam(n.R8,-1)?(0,n.Lh)(t):t.tryGetProperty(a.Q$.ZoomDuration,n.cS)}static getPanRadiansPerMs(t,e,i,s){if(void 0!==s)return(0,h.rX)(s);if(-1!==t.getOverrideParam(n.R8,-1)){const e=(0,n.Lh)(t);return e>0?i/e:0}const o=e?t.tryGetProperty(a.Q$.DollhousePanSpeed,n.lo):t.tryGetProperty(a.Q$.PanSpeed,n.BU);return(0,h.rX)(o)}static getPanValues(t,e,{panDirection:i,panAngle:o,panSpeed:r,panAlignment:a}={}){const h=H.getPanDirection(t,i),d=H.getPanDegrees(t,o),l=(0,s.pu)(d),c=H.getPanRadiansPerMs(t,e,l,r),u=H.getPanAlignment(t,a);let p=c>0?l/c:0;return e&&void 0===o&&(p=(0,n.Lh)(t)),{degrees:d,radiansPerMs:c,ms:p,direction:h,alignment:u}}static getTransitionSpeed(t){if(-1!==t.getOverrideParam("wts",-1))return t.tryGetProperty(n._V,n.aS);const e=t.tryGetProperty(a.Q$.TransitionSpeed,n.Dj);return(0,h.f7)(e/1e3)}static getTransitionTime(t){const e=t.tryGetProperty(a.Q$.TransitionTime,n.VD);return Math.min(Math.max(n.K1,e),n.s$)}static getOtherModeTransitionTime(t,e,i){if(i===g.fl.FadeToBlack){return H.getTransitionTime(t)+n.IT}let o=n.BS,r=n.uO;if(-1===t.getOverrideParam("wts",-1)){const e=1e3*H.getTransitionSpeed(t);o=Math.sqrt(2*(e-n.g$))+45,e!==n.Dj&&(r=n.Jb)}const a=1e3*e/(s.fy*o);return Math.max(a,r)}static getSamePanoTransitionTime(t,e){const i=t.tryGetProperty(a.Q$.PanSpeed,n.BU);if(i===n.BU)return Math.max(1e3*e/(s.fy*n.Md),n.fi);{const t=(0,o.m9)(i,n.Ih,n.at,n.mf,n.QR),s=(0,h.rX)(t);return s>0?e/s:0}}getFloorTransition(t){var e;const i=this.tourData.getTourEntrySidFromIndex(t),s=null===(e=this.tourData.getTourEntry(i))||void 0===e?void 0:e.snapshot;if(!s){return new l(t)}return new V(s,t,this.issueCommand,(()=>this.floorsViewData.currentFloorId))}getMainTransition(t,e){var i,s;const n=this.tourData.getTourEntrySidFromIndex(t),r=null===(i=this.tourData.getTourEntry(n))||void 0===i?void 0:i.snapshot;if(!r){return new l(t)}const a={position:this.cameraData.pose.position,rotation:this.cameraData.pose.rotation,viewMode:this.viewmodeData.peekabooCorrectedMode(this.cameraData)||r.metadata.cameraMode},h=null!==(s=this.getBurnsTransition(t).startPose)&&void 0!==s?s:{position:r.metadata.cameraPosition.clone(),rotation:r.metadata.cameraQuaternion.clone(),viewMode:r.metadata.cameraMode};let d=null;if(e===g.fl.Interpolate){let e=null;if(this.viewmodeData.isInside()&&r.metadata.cameraMode===C.N3.Panorama&&(e=this.walkingPath.getValidWalkingPath(r)),e){const i=e.map((t=>t.position)),s=this.pathOrientHelper.getOrientationsForPath(i,(0,o.V5)(h.rotation));d=e.length>2?new I({path:e,orientations:s,startPose:a},t,this.settingsData,this.cameraData.transition,this.sweepData.transition,this.sweepModule,this.cameraPoseController,this.engine,this.setRestrictedSweeps,this.getCurveForPath):new f({path:e,orientations:s,startPose:a},t,this.settingsData,this.moveToSweep,this.updateTransitionSpeed,this.setRestrictedSweeps,this.engine)}}else if(e===g.fl.Instant){const e=this.sweepData.currentSweep;d=new b({snapshot:r,currentSweep:e,startPose:a,endPose:h},t,this.moveToSweep,this.cameraPoseController,this.switchToMode)}if(!d){const i=this.sweepData.currentSweep;d=new x({snapshot:r,currentSweep:i,transitionType:e,startPose:a,endPose:h},t,this.settingsData,this.cameraPoseController,this.sweepModule,this.switchToMode,this.setRestrictedSweeps,this.engine)}return d}getBurnsTransition(t,e=this.getBurnsStyleForSnapshot(t),i){const s=this.tourData.getTourEntrySidFromIndex(t),o=this.tourData.getTourEntry(s),n=this.tourData.getHighlightsCount(),r=this.tourData.getTourEntrySidFromIndex((t+1)%n),a=this.tourData.getTourEntry(r);if(!o||!a)return new l(t);const c=o.snapshot,m=a.snapshot,g=Object.assign({},o.overrides);let w=new l(t);switch(e){case d._y.Pan:if(t+1<n&&(0,h.Lt)(o.snapshot,a.snapshot)&&H.getPanValues(this.settingsData,!1,g).direction===d.ND.Auto){const e=this.getBurnsTransition(t+1);e instanceof k.H&&"center"===e.alignment&&(g.panDirection=-e.direction)}w=new k.H({snapshot:c,nextSnapshot:m,panOverrides:g,duration:i},t,this.settingsData,this.startRotateTransition,this.stopCamera,this.walkingPath);break;case d._y.PanDollhouse:w=new O({snapshot:c,nextSnapshot:m,panOverrides:g,duration:i},t,this.settingsData,this.startRotateTransition,this.stopCamera);break;case d._y.Zoom:w=new p({duration:null!=i?i:H.getZoomDuration(this.settingsData)},t,this.startZoomTransition,this.stopCamera);break;case d._y.Delay:w=new u(null!=i?i:H.getDelayDuration(this.settingsData),t);break;case d._y.None:w=new l(t);break;default:throw Error("unhandled TourBurnsStyle")}return w}}},79769:(t,e,i)=>{i.r(e),i.d(e,{FAST_FORWARD_FACTOR:()=>R,default:()=>F});var s=i(48734),o=i(60152),n=i(75578),r=i(2993),a=i(96425),h=i(21875),d=i(44481),l=i(99583),c=i(13893),u=i(22937),p=i(78079),m=i(44667),g=i(27947),w=i(22585),T=i(25316),v=i(20599),P=i(79728),y=i(1333),D=i(88664),f=i(8333),S=i(68930),M=i(71687),I=i(35447),C=i(47737),x=i(10843),b=i(68387);const R=5;class F extends n.n{constructor(){super(...arguments),this.name="tours-controls",this.canChangeTourLocation=()=>{const t=this.data.getTourState(),e=this.data.isTourTransitionActive(),i=this.cameraData.canTransition();return t===a.Ci.Inactive&&!e&&!(this.viewmodeData.transition&&this.viewmodeData.transition.active)&&i}}async init(t,e){this.engine=e,[this.cameraData,this.viewmodeData,this.settingsData,this.data,this.toursViewData]=await Promise.all([e.market.waitForData(v.M),e.market.waitForData(l.X),e.market.waitForData(T.o),e.market.waitForData(h.R),e.market.waitForData(d.F)]);const i=await e.market.waitForData(C.P),s=await e.getModuleBySymbol(M.Wh);e.getModuleBySymbol(M.mL).then((t=>{t.registerHandler(p.CD,(()=>{this.handleTourInputInterrupt()})),t.registerHandler(m.s,(()=>{this.handleTourInputInterrupt()}))})),e.market.waitForData(b.B).then((t=>this.roomBoundViewData=t)),this.transitionFactory=new P.A(e,this.data,s,this.cameraData,this.settingsData,this.viewmodeData),await this.transitionFactory.init(),this.setupAutoPlay(e),this.bindings.push(i.onPropertyChanged("currentViewId",(()=>this.stopTour())))}handleTourInputInterrupt(){this.data.getTourState()!==a.Ci.Inactive&&this.stopTour()}canTourProceed(t,e,i){const s=this.data.getHighlightsCount();if(0===s||0===i||this.data.getTourState()!==a.Ci.Inactive)return!1;if(void 0!==e){if(e<-1)return!1;if(!0!==t&&e>s-1)return!1}return!0}shouldTourContinue(t,e,i,s){return void 0!==s?i<s:e<t-1}startTour({index:t,steps:e,loop:i}={}){if(!this.canChangeTourLocation())throw new S.r("Cannot start tour at this time, another transition is active");const n=void 0!==i?i:this.data.isLooping();if(!this.canTourProceed(n,t,e))return;this.data.setLooping(n);const r=this.data.getActiveReelTourMode(),h=(0,I.Kl)(this.settingsData,r),d=this.data.getTourCurrentSnapshotIndex(),l=this.data.getHighlightsCount(),c=this.data.transition,p=d===l-1&&(y.h9.includes(c.type)||!h)&&c.toIndex===l-1&&c.stopped-c.started>=c.duration;let m,g=0;m=void 0!==t?t-1:p?-1:Math.max(d-1,-1);const w=(0,o.dJ)(this.settingsData)>-1,[T]=this.data.getCurrentTourState().highlights;!(!0===this.settingsData.tryGetProperty("quickstart",!1))&&w&&-1===m&&!this.data.tourWillResume&&(0,I.Qx)(T)&&(m+=1);const v=this.settingsData.tryGetProperty(f.Oe,null);this.settingsData.setProperty(f.Oe,null);const P=this;this.tourGenerator=function*(){for(;P.shouldTourContinue(l,m,g,e);){const t=m+1,e=P.composeTourTransition(t);yield new s.sv(e),m=t,m===l-1&&n&&(m=-1),g++}P.stopTour(),P.settingsData.setProperty(f.Oe,v)},this.engine.startGenerator(this.tourGenerator),this.data.setTourState(a.Ci.Active),this.data.tourEnded=!1,this.data.tourWillResume=!1,this.data.tourPlaying=!0,this.data.tourPlayedCount+=1,this.data.commit(),this.engine.broadcast(new u.zM)}async composeTourTransition(t,e,i){var s,n,h,d;const l=this.data.getTourEntrySidFromIndex(t),p=this.data.getTourEntry(l);if(!p||!p.snapshot)throw Error(`Highlight not found for reel index ${t}`);const m=this.data.getTourCurrentSnapshotSid()===l,g=this.cameraData.transition.startTime>this.data.transition.stopped;let w=0;const T=this.data.transition.duration;if(m){const{started:t,stopped:e}=this.data.transition;w=(e-t)/T||0,w=Math.min(1,w)}if(g||!m){let e=this.settingsData.tryGetProperty(D.zk,c.fl.Interpolate);const o=p.snapshot.metadata.cameraMode,n=o===r.N3.Dollhouse||o===r.N3.Floorplan,h=(0,r.nI)(o),d=!this.viewmodeData.isInside()&&h,l=this.viewmodeData.isInside()&&n,m=!this.viewmodeData.isInside()&&n,g=this.viewmodeData.isInside()&&h;(d||l||m)&&(e=c.fl.Interpolate),void 0!==(null===(s=null==p?void 0:p.overrides)||void 0===s?void 0:s.transitionType)&&(e=p.overrides.transitionType),g&&0===t&&(e=c.fl.FadeToBlack),void 0!==i&&(e=i),this.engine.broadcast(new u.zb(t));const w=this.transitionFactory.getFloorTransition(t).start();if(this.data.useTransition(w),await w.promise,this.data.getTourState()===a.Ci.StopScheduled)return;const T=this.transitionFactory.getMainTransition(t,e).start();this.data.useTransition(T),await T.promise,this.data.setTourCurrentSnapshotByIndex(t),this.engine.broadcast(new u.n1(t))}if(this.data.getTourState()===a.Ci.StopScheduled)return;let v;this.toursViewData.getTourStoryMode()&&this.transitionFactory.isStaticFinalStop(t)&&(v=o.Dw),w>0&&(v=(1-w)*T);const P=this.transitionFactory.getBurnsTransition(t,e,v).start(),y=(null===(n=p.overrides)||void 0===n?void 0:n.showRoomMeasurements)||!1;y&&(null===(h=this.roomBoundViewData)||void 0===h||h.forceRoomDimensionVisibility(!0)),this.engine.broadcast(new u.BW(t,P.type,P.duration)),this.data.useTransition(P),await P.promise,y&&(null===(d=this.roomBoundViewData)||void 0===d||d.forceRoomDimensionVisibility(!1))}async stopTour({willResume:t=!1}={}){this.data.getTourState()===a.Ci.Active&&(this.data.setTourState(a.Ci.StopScheduled),this.data.tourWillResume=t,this.data.tourPlaying=!1,await this.data.stopTourTransition(),this.tourGenerator&&this.engine.stopGenerator(this.tourGenerator),this.engine.broadcast(new u.pT(t)),this.data.getTourCurrentSnapshotIndex()!==this.data.getHighlightsCount()-1||this.data.isLooping()||(this.data.tourEnded=!0,this.engine.broadcast(new u.YH)),this.data.setTourState(a.Ci.Inactive),this.data.commit())}async tourGoNext(t){let e=this.data.getTourCurrentSnapshotIndex()+1;return e>=this.data.getHighlightsCount()&&(e=0),this.tourGoTo(e,t)}async tourGoPrevious(t){let e=this.data.getTourCurrentSnapshotIndex();e<0&&(e=0);let i=e-1;return i<0&&(i=this.data.getHighlightsCount()-1),this.tourGoTo(i,t)}async tourGoTo(t,{transitionType:e=c.fl.FadeToBlack,instant:i,resumeIfPlaying:s=!1}={}){if(this.viewmodeData.transition&&this.viewmodeData.transition.active)throw new S.K("Cannot go to tour location during viewmode transition");const o=this.data.tourPlaying;o&&await this.stopTour({willResume:s});try{this.data.setTourState(a.Ci.Active),await this.composeTourTransition(t,y._y.None,i?c.fl.Instant:e)}catch(t){x.Ay.for(this).error(t)}finally{this.data.setTourState(a.Ci.Inactive)}s&&o&&this.startTour()}setupAutoPlay(t){const e=1e3*(0,o.dJ)(this.settingsData),i=()=>{let t=!0;const i=this.cameraData.pose.onChanged((()=>{t=!1,i.cancel()}));setTimeout((()=>{t&&this.startTour(),i.cancel()}),e)};if(e>=0){const e=t.market.tryGetData(g.zH);if(e&&e.phase===g.Jj.PLAYING)i();else{const e=s=>{s.phase===g.Jj.PLAYING&&(i(),t.unsubscribe(w.uv,e))};t.subscribe(w.uv,e)}}}}},52947:(t,e,i)=>{i.d(e,{Ay:()=>n,F7:()=>a,cF:()=>r});var s=i(68909);class o{constructor(t,e){this.raycast=(()=>{const t=new s.Vector3,e=new s.Box3;return(i,s,n,h)=>{const d=e.copy(this.bounds).expandByScalar(s);if(i.ray.intersectsBox(d))for(const e of this.children)if(e instanceof o)e.raycast(i,s,n,h);else if(e instanceof r){if(!1===(null==h?void 0:h(e)))continue;const o=t,r=i.ray.distanceSqToSegment(e.start,e.end,void 0,t),a=Math.sqrt(r);a<s&&n.push({distance:i.ray.origin.distanceTo(o),object:e,distanceToRay:a,point:o.clone(),isLineOctreeIntersection:!0})}else if(e instanceof a){if(!1===(null==h?void 0:h(e)))continue;const t=i.ray.distanceToPoint(e);t<s&&n.push({distance:i.ray.origin.distanceTo(e),object:e,distanceToRay:t,point:e.clone(),isLineOctreeIntersection:!0})}}})(),this.level=e,this.bounds=t.clone(),this.clear()}clear(){this.childNodes=[],this.children=[]}add(t){let e=!1;const i=t instanceof s.Line3?[t.start,t.end]:[t];if(this.level<4){0===this.childNodes.length&&this.buildChildNodes();for(const s of this.childNodes)i.every((t=>s.bounds.containsPoint(t)))&&(e=!0,s.add(t))}e||this.children.push(t)}remove(t){const e=t instanceof s.Line3?[t.start,t.end]:[t];for(let i=0;i<this.children.length;i++){const s=this.children[i];if(s instanceof o){if(e.every((t=>s.bounds.containsPoint(t)))&&s.remove(t))return!0}else if(s===t)return this.children.splice(i,1),!0}return!1}buildChildNodes(){const t=this.bounds.max.clone().sub(this.bounds.min).clone().multiplyScalar(.5);for(let e=0;e<2;e++)for(let i=0;i<2;i++)for(let n=0;n<2;n++){const r=this.bounds.min.x+t.x*n,a=r+t.x,h=this.bounds.min.y+t.y*e,d=h+t.y,l=this.bounds.min.z+t.z*i,c=l+t.z,u=new s.Box3(new s.Vector3(r,h,l),new s.Vector3(a,d,c)),p=new o(u,this.level+1);this.childNodes.push(p),this.children.push(p)}}spherecast(t,e){if(t.intersectsBox(this.bounds))for(const i of this.children)if(i instanceof o)i.spherecast(t,e);else if(i instanceof r){const o=i.closestPointToPoint(t.center,!0,new s.Vector3);o.distanceTo(t.center)<t.radius&&e.push(new a(o))}else i instanceof s.Vector3&&i.distanceTo(t.center)<t.radius&&e.push(i)}traverse(t){for(const e of this.children)e instanceof o?e.traverse(t):t(e)}}class n{constructor(t){this.pointCount=0,this.lineCount=0,this.root=new o(t,0)}add(t){t instanceof s.Line3?this.lineCount++:t instanceof s.Vector3&&this.pointCount++,this.root.add(t)}remove(t){t instanceof r?this.lineCount--:t instanceof a&&this.pointCount--,this.root.remove(t)}clear(){this.root.clear(),this.pointCount=0,this.lineCount=0}traverse(t){this.root.traverse(t)}raycast(t,e,i){const s=[];return this.root.raycast(t,e,s,i),s}}class r extends s.Line3{constructor(t,e){super(t,e),this.start=t,this.end=e,this.isSnapLine3=!0}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}clone(){return new r(this.start,this.end)}}class a extends s.Vector3{constructor(t){super(),this.point=t,this.isSnapVector3=!0,super.copy(t)}copy(t){return this.point.copy(t.point),this}clone(){return new a(this.point)}}},23987:(t,e,i)=>{i.d(e,{Z:()=>s});const s=new class{constructor(t=!0){this.values=new Map,t&&this.show()}clear(){this.values.clear(),this.drawValues()}show(){if(this.debugDiv)return;this.debugDiv=document.createElement("div");const t=this.debugDiv.style;t.fontFamily="monospace",t.position="fixed",t.backgroundColor="#aa11aa",t.left="20px",t.top="20px",t.zIndex="999899",t.pointerEvents="none",t.touchAction="none",document.body.appendChild(this.debugDiv),this.drawValues()}hide(){this.debugDiv&&(document.body.removeChild(this.debugDiv),this.debugDiv=void 0)}logValue(t,e){this.values.set(t,e),this.drawValues()}logMaxValue(t,e){this.values.has(t)?e>this.values.get(t)&&this.logValue(t,e):this.logValue(t,e)}logVector2(t,e){this.logValue(t,`(${e.x}, ${e.y})`)}logVector3(t,e){this.logValue(t,`(${e.x}, ${e.y}, ${e.z})`)}logVector4(t,e){this.logValue(t,`(${e.x}, ${e.y}, ${e.z} ${e.w})`)}logPose(t,e){this.logVector3(t+"-pos",e.position),this.logVector4(t+"-rot",e.rotation),this.logValue(t+"-focalDist",e.focalDistance)}showPt(t){if(this.pointDiv)this.pointDiv.style.left=`${t.x}px`,this.pointDiv.style.top=`${t.y}px`;else{this.pointDiv=document.createElement("div");const e=this.pointDiv.style;e.position="fixed",e.width="8px",e.height="8px",e.backgroundColor="#aaffaa",e.left=t.x-4+"px",e.top=t.y-4+"px",e.zIndex="99999",e.pointerEvents="none",e.touchAction="none",document.body.appendChild(this.pointDiv)}}drawValues(){if(!this.debugDiv)return;let t="";for(const[e,i]of this.values.entries())t+=`${e}: ${i}<br>`;this.debugDiv.innerHTML=t}}}}]);