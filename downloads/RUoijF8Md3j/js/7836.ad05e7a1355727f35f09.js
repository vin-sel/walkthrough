"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[7836],{97573:(t,i,e)=>{e.d(i,{EH:()=>o,nB:()=>n,v6:()=>r});var s=e(15045);const n=(t,i=200)=>{let e=0,n=0;const o=1/t,r=t=>t.width/t.height;return[{property:s.ResizeProperty.width,setDimension:i=>(e=r(i)<t?i.width:i.height*t,e),duration:i},{property:s.ResizeProperty.height,setDimension:i=>(n=r(i)<t?i.width*o:i.height,n),duration:i},{property:s.ResizeProperty.top,setDimension:i=>r(i)<t?(i.height-n)/2:0,duration:i},{property:s.ResizeProperty.left,setDimension:i=>r(i)<t?0:(i.width-e)/2,duration:i}]},o=(t=200)=>[{property:s.ResizeProperty.width,setDimension:t=>t.width,duration:t},{property:s.ResizeProperty.height,setDimension:t=>t.height,duration:t},{property:s.ResizeProperty.top,setDimension:()=>0,duration:t},{property:s.ResizeProperty.left,setDimension:()=>0,duration:t}],r=(t,i,e,n=200)=>{const o=[];return void 0!==t&&o.push({property:s.ResizeProperty.width,setDimension:i=>i.width+t,duration:n}),void 0!==i&&o.push({property:s.ResizeProperty.height,setDimension:t=>t.height+i,duration:n}),void 0!==e&&o.push({property:s.ResizeProperty.left,setDimension:()=>e,duration:n}),o}},15045:(t,i,e)=>{e.r(i),e.d(i,{ResizeProperty:()=>s,default:()=>g});var s,n=e(75578),o=e(37105),r=e(73927),a=e(94334),h=e(31093),c=e(52018),u=e(58095),p=e(20599);class d extends c.t{}!function(t){t.left="left",t.top="top",t.width="width",t.height="height"}(s||(s={}));const l={[s.width]:"width",[s.height]:"height",[s.top]:"top",[s.left]:"left"};class g extends n.n{constructor(){super(...arguments),this.name="canvas",this.getNewX=()=>0,this.getNewY=()=>0,this.getNewWidth=t=>t.width,this.getNewHeight=t=>t.height,this.activeTransitions=[],this.activeTransitionMap={left:null,top:null,width:null,height:null},this.onResize=t=>{t.propertyName in s&&(this.resolveActiveTransition(t.propertyName),this._canvas.style.transitionDuration=this.stringifyTransitionDurations())},this.onContainerResize=()=>{this.transitionDurations.left=this.transitionDurations.top=this.transitionDurations.width=this.transitionDurations.height="0s",this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition(),this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),this._canvas.style.transitionDuration=this.stringifyTransitionDurations()}}async init(t,i){if(this.engine=i,!t.container)throw new d;this.container=t.container,this.container.appendChild(t.canvas),this.containerBounds=this.container.getBoundingClientRect(),this._canvas=t.canvas,this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this.transitionDurations={left:"0s",top:"0s",width:"0s",height:"0s",filter:"0.4s"},this._canvas.style.transitionProperty=Object.keys(this.transitionDurations).join(","),this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.updateTransitions(),this.bindings.push(i.subscribe(u.P,this.onContainerResize),this.makeTransitionEndSubscription());for(const t of this.bindings)t.renew();this.canvasBounds=this._canvas.getBoundingClientRect(),this.containerBounds=this.container.getBoundingClientRect(),this.data=new o.p(this.canvasBounds.width,this.canvasBounds.height,this._canvas),i.market.register(o.p,this.data),this.cameraData=await this.engine.market.waitForData(p.M)}async resizeCanvas(t){return 0===t.length?[]:(this.cameraData&&!this.cameraData.canTransition()&&await this.cameraData.transition.promise,this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),t.forEach((t=>{const{property:i,setDimension:e,duration:n=0}=t,o=l[i],r=this._canvas.style[o];switch(i){case s.height:this.setHeight(e,n);break;case s.width:this.setWidth(e,n);break;case s.top:this.setY(e,n);break;case s.left:this.setX(e,n)}if(this._canvas.style[o]!==r&&n>0){const t=new h.i;t.then((()=>{clearTimeout(e)}));const e=setTimeout((()=>{this.resolveActiveTransition(i)}),n+500);this.activeTransitionMap[i]=t,this.activeTransitions.push(i)}})),this.hasActiveTransitions()||(this.canvasBounds=this._canvas.getBoundingClientRect()),this.getTransitionPromise())}makeTransitionEndSubscription(){let t=!1;return{renew:()=>{t||(this.element.addEventListener("transitionend",this.onResize),t=!0)},cancel:()=>{t&&(this.element.removeEventListener("transitionend",this.onResize),t=!1)}}}dispose(t){super.dispose(t)}get element(){return this._canvas}get width(){return this.canvasBounds.width}get height(){return this.canvasBounds.height}get x(){return this.canvasBounds.left}get y(){return this.canvasBounds.top}onUpdate(){const t=this.container.getBoundingClientRect(),i=this.containerHasChanged(t);i&&(this.containerBounds=t,this.updateTransitions()),(i||this.hasActiveTransitions())&&(this.canvasBounds=this._canvas.getBoundingClientRect());const e=this.data.width!==this.width||this.data.height!==this.height,s=this.data.x!==this.x||this.data.y!==this.y;e&&(this.data.width=this.width,this.data.height=this.height,this.data.commit(),this.engine.broadcast(new r.h(this.width,this.height))),s&&(this.data.x=this.x,this.data.y=this.y,this.data.commit(),this.engine.broadcast(new a.C(this.x-this.containerBounds.left,this.y-this.containerBounds.top)))}containerHasChanged(t){return t.left!==this.containerBounds.left||t.top!==this.containerBounds.top||t.width!==this.containerBounds.width||t.height!==this.containerBounds.height}setX(t,i=0){this.getNewX="number"==typeof t?()=>t:t,this.transitionDurations.left=`${i}ms`,this.updateTransitions()}setY(t,i=0){this.getNewY="number"==typeof t?()=>t:t,this.transitionDurations.top=`${i}ms`,this.updateTransitions()}setWidth(t,i=0){this.getNewWidth="number"==typeof t?()=>t:t,this.transitionDurations.width=`${i}ms`,this.updateTransitions()}setHeight(t,i=0){this.getNewHeight="number"==typeof t?()=>t:t,this.transitionDurations.height=`${i}ms`,this.updateTransitions()}screenToCanvasPoint(t,i){return{x:t-this.x,y:i-this.y}}getTransitionPromise(){return Promise.all(this.activeTransitions.map((t=>this.activeTransitionMap[t])).filter((t=>!!t)))}updateTransitions(){this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition()}applySize(){this._canvas.style.width=`${this.getNewWidth(this.containerBounds)}px`,this._canvas.style.height=`${this.getNewHeight(this.containerBounds)}px`}applyPosition(){this._canvas.style.left=`${this.getNewX(this.containerBounds)}px`,this._canvas.style.top=`${this.getNewY(this.containerBounds)}px`}stringifyTransitionDurations(){return Object.keys(this.transitionDurations).map((t=>this.transitionDurations[t])).join(",")}resolveActiveTransition(t){this.canvasBounds=this._canvas.getBoundingClientRect();const i=this.activeTransitions.indexOf(t);-1!==i&&this.activeTransitions.splice(i,1);const e=this.activeTransitionMap[t];e&&e.resolve(),this.activeTransitionMap[t]=null,this.transitionDurations[t]="0s"}hasActiveTransitions(){return this.activeTransitions.length>0}}},58095:(t,i,e)=>{e.d(i,{H:()=>o,P:()=>n});var s=e(89103);class n extends s.QB{constructor(t,i){super(),this.width=t,this.height=i}}class o extends s.QB{constructor(t){super(),this.orientation=t}}},83075:(t,i,e)=>{e.d(i,{PO:()=>n,m2:()=>o});var s=e(99276);const n=t=>!!t&&t instanceof s.B,o={hasMeshGroup:t=>"object"==typeof t&&!!t&&"meshGroup"in t,hasMeshSubgroup:t=>"object"==typeof t&&!!t&&"meshSubgroup"in t,isRoomMesh:n,isVisibleRoomMesh:t=>n(t)&&t.raycastEnabled&&t.visible}},35699:(t,i,e)=>{e.d(i,{X:()=>n});var s=e(55141);class n extends s.u{constructor(t=null){super(),this.payload={cursor:t}}}n.id="SET_MOUSE_CURSOR"},77510:(t,i,e)=>{var s;e.d(i,{b:()=>s}),function(t){t.NONE="none",t.DEFAULT="default",t.MOVE="move",t.MOVE_LF="col-resize",t.MOVE_UD="row-resize",t.XHAIR="crosshair",t.PLUS="cell",t.QUESTION="help",t.NOPE="not-allowed",t.FINGER="pointer",t.TEXT="text",t.TEXT_VERT="vertical-text",t.ZOOM_IN="zoom-in",t.ZOOM_OUT="zoom-in",t.GRAB="grab",t.GRABBING="grabbing",t.ARROW_R="e-resize",t.ARROW_L="w-resize",t.ARROW_U="n-resize",t.ARROW_D="s-resize",t.ARROW_UR="ne-resize",t.ARROW_UL="nw-resize",t.ARROW_DR="se-resize",t.ARROW_DL="sw-resize",t.ARROW_LR="ew-resize",t.ARROW_UD="ns-resize",t.ARROW_URDL="nesw-resize",t.ARROW_ULDR="nwse-resize",t.ROOMBOUNDS_DEFAULT="rbe-default",t.ROOMBOUNDS_MOVING="rbe-moving",t.ROOMBOUNDS_PLACE_NODE="rbe-place-node",t.ROOMBOUNDS_FINISH_ROOM="rbe-finish-room"}(s||(s={}))},52026:(t,i,e)=>{e.d(i,{GI:()=>l,I9:()=>g,IV:()=>d,VM:()=>p,Y7:()=>v,vM:()=>u});var s=e(78229),n=e(96659),o=e(65882);if(5602==e.j)var r=e(3066);if(5602==e.j)var a=e(9997);var h=e(40397),c=e(86866);const u={count:0};function p(t){return(0,r.Sh)((()=>t(new a.Jq)),(()=>t(new a.sD)),!1)}const d=t=>{const{additionalFilter:i,sweepData:e,direction:o,sourceSweep:r,ignoreSweeps:a,directionFactor:h}=t;if(!e.currentSweepObject)return[];const c=r||e.currentSweepObject,u=[s.AU(c),s.Ol(),s.xg(c),s.jW(c.position,o,h)];for(const t of a)u.push(s.AU(t));const p=[n.oW(c.position,o),n.Io(c.position)];i&&u.push(i);const d=e.getSweepNeighbours(c);return e.sortByScore(u,p,d)},l=t=>{const{sweepData:i,direction:e,viewDirection:r,sourceSweep:a,ignoreSweeps:h,directionFactor:c,additionalFilter:p,meshQuery:d,scorers:l=[],filters:g=[]}=t;if(!i.currentSweepObject)return[];const v=e.clone().normalize(),w=r?r.clone().normalize():void 0,m=a||i.currentSweepObject;g.push(s.AU(m),s.Ol(),s.fm(m.position,o.U.maxDistSameFloor*o.U.maxDistSameFloor),s.Zx());for(const t of h)g.push(s.AU(t));return d&&!m.neighborsEdited||g.push(s.xg(m)),w?g.push(f(m,v,w,null!=c?c:o.U.directionFactor,o.U.viewDirectionFactor)):g.push(s.jW(m.position,v,c)),p&&g.push(p),d&&!m.neighborsEdited&&g.push(R(m,d)),w&&l.push(n.VY(m.position,w,o.U.viewDirectionWeight)),l.push(n.oW(m.position,v,o.U.directionWeight),n.Io(m.position),D(m),y(m.sourceViewId)),u.count=0,i.sortByScore(g,l)},g=(t,i,e,r,a=[],h=[])=>{h.push(s.Ol(),s.Zx()),a.push(n.Io(e.point));const c=t.currentSweepObject;i&&c?(h.push(s.AU(c),s.lp(c.position,o.U.longerTransitionMaxDist),s.xg(c)),a.push(w(t),y(c.sourceViewId))):h.push(s.lp(e.point,o.U.longerTransitionMaxDist)),e.face&&h.push(s.DJ(e.point,e.face.normal));const p=r.floorIdFromObject(e.object);p&&h.push(s.Eo(p));const d=r.mdsRoomIdFromObject(e.object);d&&h.push(m(d)),u.count=0;const l=t.sortByScore(h,a);if(0===l.length){const i=t.getClosestSweep(e.point,!0);l.push({sweep:i,score:0})}return l},v=(t,i,e)=>{const s=(0,h.kf)(t,i);return e&&s.multiply(e),(0,c.V5)(s)},w=t=>{function i(i){return t.containsSweep(i.id)?5:-5}return Object.defineProperty(i,"name",{value:"_preferUnfiltered"}),i},y=t=>{function i(i){return t===i.sourceViewId?1:-1}return Object.defineProperty(i,"name",{value:"_bySameView"}),i},m=t=>{function i(i){return t===i.roomId}return Object.defineProperty(i,"name",{value:"_bySameRoom"}),i},f=(t,i,e,n,o)=>{const r=s.jW(t.position,i,n);Object.defineProperty(r,"name",{value:"_filterByDir"});const a=s.Zz.some(s.Zz.every(r,s.lp(t.position,5)),s.jW(t.position,e,o));Object.defineProperty(a,"name",{value:"_filterByDirOrViewDir"});return i.dot(e)<.25?r:a},R=(t,i)=>{function e(e){return u.count++,!i.isSegmentOccluded(t.position,e.position)}return Object.defineProperty(e,"name",{value:"_notRaycastNeighbors"}),e},D=t=>{function i(i){return s.xg(t)(i)?1:-1}return Object.defineProperty(i,"name",{value:"_visionNeighbors"}),i}},95102:(t,i,e)=>{e.d(i,{m:()=>n});var s=e(68909);class n extends s.Mesh{constructor(t,i){super(t,i)}}}}]);