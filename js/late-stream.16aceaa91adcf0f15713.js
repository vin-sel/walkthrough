"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[2276],{12850:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var i=n(15564),r=n(90082),s=n(32484),a=n(71687);const{TEXTURE_SETTINGS:o,clearRaycastHits:l}=s.yJ;const u=async function(e){const t=await e.getModuleBySymbol(r.ZF),n=await e.getModuleBySymbol(a.GR),s=t.addPanel(i.F.TITLE,i.F.HOTKEYS,{width:350});await t.loadPromise.then((()=>{const e="meshtextures";[{panel:s,header:e,setting:"disableTextureStreamBelowLod",initialValue:()=>-1,onChange:e=>{e>-1&&n.textureQualityMap.limitStreamingBelow(e)},urlParam:!0,rangePrecision:0,range:[-1,7]},{panel:s,header:e,setting:"textureStreamPause",initialValue:()=>o.debugPauseTexStream,onChange:e=>{o.debugPauseTexStream=e},urlParam:!0},{panel:s,header:e,setting:"textureStreamRaycastHits",initialValue:()=>o.debugLOD,onChange:e=>{o.debugLOD=e,e||l()},urlParam:!0},{panel:s,header:e,setting:"debugRTTQuality",initialValue:()=>o.debugRttQuality,onChange:e=>{o.debugRttQuality=e,e||n.setMeshOverlay({})},urlParam:!0},{panel:s,header:e,setting:"debugRTTScores",initialValue:()=>o.debugRttScores,onChange:e=>{o.debugRttScores=e,e||n.setMeshOverlay({})},urlParam:!0}].forEach((e=>t.registerMenuEntry(e)))}))}},86465:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var i=n(68909),r=n(84440),s=n(25316),a=n(90082),o=n(26072),l=n(32502),u=n(47299),h=n(50839),d=n(90351),g=n(2593),c=n(71687);async function m(e){const t=await e.getModuleBySymbol(c.GR),[n,m,p]=await Promise.all([e.market.waitForData(s.o),e.getModuleBySymbol(a.ZF),e.getModuleBySymbol(c.UN)]);await m.loadPromise.then((()=>{m.registerButton("Mesh","Toggle visible",(()=>{t.meshes.forEach((e=>{e.modelMesh.visible=!e.modelMesh.visible}))})),m.registerButton("Mesh","Toggle UV debug",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:l.f.UV;t.setChunkRenderingMode(n)}))})),m.registerButton("Mesh","Toggle depth",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:l.f.Depth;t.setChunkRenderingMode(n)}))})),m.registerButton("Mesh","Toggle transparent",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:l.f.Transparent;t.setChunkRenderingMode(n)}))})),m.registerButton("Mesh","Toggle wireframe",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:l.f.Wireframe;t.setChunkRenderingMode(n)}))}));let e=!0===Boolean(new URLSearchParams(window.location.search).get("flat"));const s=()=>{t.meshes.forEach((t=>{t.modelMesh instanceof d.f&&t.modelMesh.notifyOnChunksLoaded((t=>{for(const n of t)n.setFlatShading(e)}));for(const n of t.modelMesh.chunks)n.setFlatShading(e)}))};s(),m.registerButton("Mesh","Toggle flat shading",(()=>{e=!e,s()}));const a=(()=>{let e=!1;return(n,s)=>{const a=new i.Vector4(1,1,1,0);var o;e=!e,o=n||e,t.meshes.forEach((e=>{for(const t of e.modelMesh.chunks){const e=s?100*t.id:100*t.meshSubgroup,n=o?(0,r.Zd)(.5,e):a;t.setColorOverlay(n)}}))}})();m.registerButton("Mesh","Highlight Rooms",a),m.registerButton("Mesh","Highlight Chunks",(()=>a(!0,!0))),n.onPropertyChanged(u.Vp,(e=>{t.meshes.forEach((t=>{const n=p.getFullBounds();for(const i of t.modelMesh.chunks)i.setMaterialsUniform({floorTrimHeight:1-e/100,floorHeightMin:n.min.y,floorHeightMax:n.max.y},!0)}))}));const c=(e,t,i,r,s)=>{m.registerSetting(e,t,i,!0,o.u.NONE,s),n.onPropertyChanged(t,r)};c("Wireframe",u._Z,!1,(e=>{t.meshes.forEach((t=>{for(const n of t.modelMesh.chunks)n.setWireframe(e)}))}));const y={[h.d.Wireframe]:{Wireframe:["thickness","wireframeOpacity","stroke","fillEnabled","fill","insideAltColor","dualStroke","secondThickness"],"Wireframe Dashes":["dashEnabled","dashLength","dashAnimate","dashOverlap"],"Wireframe Advanced":["squeeze","squeezeMin","squeezeMax"]}};for(const e in y){const n=g.fu.uniforms[e];for(const i in y[e])for(const r of y[e][i])c(i,r,n[r].value,(e=>{t.meshes.forEach((t=>{for(const n of t.modelMesh.chunks)n.setMaterialsUniform({[r]:e})}))}),n[r].range)}}))}},72311:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O,tiledMeshDebugMenu:()=>C});var i=n(68909),r=n(90082),s=n(85826),a=n(244),o=n(24241),l=n(75778),u=n(71687),h=n(42120),d=n(84440),g=n(25712),c=n(32484),m=n(47299),p=n(15564);const y=new o.Vy("tiled-mesh"),{TILEDMESH_SETTINGS:f}=c.yJ,M={hideMenu:"1"!==(0,l.P3)("dmenu","0"),debug:"1"===(0,l.P3)("debugTiles","0")||"1"===(0,l.P3)("debug-tiles","0"),statsTiles:!1,statsTileset:!0,statsTextures:!0,statsTextureStream:!0};let b=null;function x(e,t,n){b||(b=document.createElement("div"),b.style.color="#FFFFFF",b.style.fontFamily="Roboto",b.style.fontWeight="300",b.style.fontSize="12px",b.style.position="absolute",b.style.top="85px",b.style.width="500px",b.style.pointerEvents="none",b.style.whiteSpace="pre",b.style.zIndex="99999",b.style.textShadow="0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black",document.body.appendChild(b));let i="\n\n";i+=function(e){const t=e.threeRenderer.info,n=`three:\n  drawCalls: ${t.render.calls}\n  geometries: ${t.memory.geometries}\n  textures: ${t.memory.textures}\n  triangles: ${t.render.triangles}\n  memory allocated (megs): ${Math.floor(e.estimatedGPUMemoryAllocated()/2**20)}`;return n}(e),i+=M.statsTextureStream?function(e){const t=`\ntextureStreaming:\n  downloadingTiles: ${e.downloadingTiles} / ${e.totalTiles}\n  downloadingTextures: ${e.loadingTextures}\n`,n="  downloaded:\n"+Object.keys(e.totalTextures).map((t=>`    ${t}: ${e.totalTextures[t]} `)).join("\n")+"\n";return t+n}(n):"",t.forEach(((e,t)=>{const n=e.modelMesh;i+=`\n\n<mesh: id:${t}>`,i+=M.statsTileset?function(e,t){var n,i,r;const s=e.tilesRenderer,a=Object.values(null!==(n=s.tileSets)&&void 0!==n?n:[])[0];return`\n  tileset: preset: ${null===(i=null==a?void 0:a.asset.extras)||void 0===i?void 0:i.preset}, depth: ${null===(r=null==a?void 0:a.asset.extras)||void 0===r?void 0:r.depth}, version: ${null==a?void 0:a.asset.tilesetVersion}\n  view: errorTarget: ${t.settings.errorTarget}, maxLOD: ${t.settings.maxLOD}, detail: '${t.detail}'\n`}(n.tileLoader,n):"",i+=M.statsTiles?function(e){const t=e.tilesRenderer,n=t.visibleTiles,i={};n.forEach((e=>{var t;const n=`lod${null===(t=e.extras)||void 0===t?void 0:t.level}`,r=i[n]||0;i[n]=r+1}));const{stats:r,downloadQueue:s,parseQueue:a,lruCache:o}=t,{active:l,downloading:u,inFrustum:h,parsing:d,used:g,visible:c}=r,m=`  tiles:\n    tiles in frustum: ${h}\n    visible: ${c}`+Object.keys(i).sort().map((e=>`\n     ${e} tiles: ${i[e]||0}`)).join()+`\n    downloading gltf: ${u}\n    parsing gltf: ${d}\n    active: ${l}\n    used: ${g}\n    queues:\n      download: ${s.currJobs} running, ${s.items.length} waiting\n      parse: ${a.currJobs} running, ${a.items.length} waiting\n    lruCache: ${o.itemSet.size}\n`;return m}(n.tileLoader):"",i+=`</mesh: id:${t}>`})),b.textContent=i}function T(e,t,n,r,a,o){S&&(e.forEach(((e,n)=>{w.has(e.modelMesh)||(w.add(e.modelMesh),E.push(...function(e,t,n,r){const s=[{panel:e,header:t.tile+": "+n,setting:"maxLOD: "+n,initialValue:()=>r.settings.maxLOD,onChange:e=>{r.settings.maxLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"nonMeshMaxLOD: "+n,initialValue:()=>r.settings.nonMeshMaxLOD,onChange:e=>{r.settings.nonMeshMaxLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"minLOD: "+n,initialValue:()=>r.settings.minLOD,onChange:e=>{r.settings.minLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"errorTarget:"+n,initialValue:()=>r.settings.errorTarget,onChange:e=>{r.settings.errorTarget=e},range:[0,20],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile+": "+n,setting:"disableTileUpdates:"+n,initialValue:()=>r.settings.disableTileUpdates,onChange:e=>{r.settings.disableTileUpdates=e}},{panel:e,header:t.tile+": "+n,setting:"disposeModel: "+n,initialValue:()=>r.settings.disposeModel,onChange:e=>{r.settings.disposeModel=e}},{panel:e,header:t.tile+": "+n,setting:"pos on z axis: "+n,initialValue:()=>0,onChange:e=>{r.position.copy(new i.Vector3(0,0,e)),r.updateMatrixWorld(!0)},range:[-100,100],rangePrecision:0}];return s}(t,r,n,e.modelMesh)),E.push(...function(e,t,n,i,r,a){const o=i.tileLoader,l=B(o,a,((e,t)=>e.setWireframe(t))),u=function(e,t){const n={scale:1},i=(t,i)=>{if(!t)return;const r=e.container.tilesByChunkId.get(t.id),s=(null==r?void 0:r.__error)||1e-4,a=t.lod!==f.maxLOD&&s>f.errorTarget?1:.5,o=Math.max(0,Math.min(1,1-n.scale/s)),l=i?k(t.lod,o,a):null;t.setColorOverlay(l)},r=B(e,t,i),a=(0,s.f)((()=>r.colorize(e.container.chunks)));return{toggle:e=>{e?a.renew():a.cancel(),r.toggle(e)},colorize:r.colorize,subscription:a,config:n}}(o,a),h=B(o,a,((e,t)=>{e.setColorOverlay(t?k(e.lod,1,.5):null)})),c=B(o,a,((e,t)=>{e.setColorOverlay(t?(0,d.Zd)(.5,e.id||0):null)})),m=B(o,a,((e,t)=>{var n;const i=o.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,d.Zd)(.5,(0,g.s5)((null===(n=null==i?void 0:i.content)||void 0===n?void 0:n.uri)||"missing")||0):null)})),p=B(o,a,((e,t)=>{e.setColorOverlay(t?(0,d.Zd)(.5,(e.meshGroup<<16)+e.meshSubgroup||0):null)})),M=B(o,a,((e,t)=>{e.setColorOverlay(t?(0,d.Zd)(.5,e.meshSubgroup||0):null)})),b=B(o,a,((e,t)=>{e.setColorOverlay(t?(0,d.Zd)(.5,e.meshGroup||0):null)})),x=B(o,a,((e,t)=>{e.setColorOverlay(t?(0,d.Zd)(.5,(0,g.s5)(e.textureName)||0):null)})),T=B(o,a,((e,t)=>{const n=o.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,d.Zd)(.5,(null==n?void 0:n.geometricError)||0):null)})),E=r.slots,w=i.textureQualityMap,S=B(o,a,((e,t)=>{const n=E.find((t=>t.textureName===e.textureName));if(n){const i=n.loading?1:n.quality>w.min(e.lod)?.7:.3,r=w.maxTexelSize/w.get(n.quality).texelSize;e.setColorOverlay(t?k(e.lod,r,i):null)}})),v=(0,s.f)((()=>S.colorize(o.container.chunks)));let C="none";const P={none:void 0,byError:u,byGeometricError:T,byTile:m,bySubgroup:M,byMeshgroup:b,bySubAndMeshgroup:p,byTexture:x,byStreamedTextures:{subscription:v,toggle:e=>{e?v.renew():v.cancel(),e&&y.info("colorize=byStreamedTextures solid color: loading, dark color: streamed, light color: basis"),S.toggle(e)}},byChunk:c,byLod:h},O=[{panel:e,header:`${t.viz}: ${n}`,setting:"disableTileUpdates:"+n,initialValue:()=>i.settings.disableTileUpdates,onChange:e=>{i.settings.disableTileUpdates=e},urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"wireframe:"+n,initialValue:()=>!1,onChange:l.toggle,urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"colorize:"+n,initialValue:()=>"none",onChange:e=>{var t,n;null===(t=P[C])||void 0===t||t.toggle(!1),null===(n=P[e])||void 0===n||n.toggle(!0),C=e},options:Object.keys(P),urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"colorizeByErrorScale:"+n,initialValue:()=>1,onChange:e=>{u.config.scale=e},range:[0,6],rangePrecision:3,urlParam:!0}];return O}(t,r,n,e.modelMesh,a,o)))})),E.length&&(E.forEach((e=>n.registerMenuEntry(e))),E.length=0))}const E=[],w=new Set;let S=!1,v=null;async function C(e){if(!M.debug)return;const t=await e.getModuleBySymbol(r.ZF),n=await e.getModuleBySymbol(u.mL),i=await e.getModuleBySymbol(u.M7),s=i.getScene(),a=await e.getModuleBySymbol(u.GR);await a.firstMeshLoadPromise,await(0,h.c)(100);const o=a.meshes,l=a.meshTextureLoader,d=t.tryGetProperty(m.sz,!1),g=t.addPanel(p.F.TITLE,p.F.HOTKEYS,{width:350}),c={viz:"visualize",stats:"stats",tile:"tileset",log:"log"};function b(){v||(v=setInterval((()=>{x(i,o,l),T(o,g,t,c,l,e)}),150))}const E=[{panel:g,header:c.stats,setting:"tilesetStatsOverlay",initialValue:()=>M.statsTileset,onChange:e=>{M.statsTileset=e,e&&b()},urlParam:!0},{panel:g,header:c.stats,setting:"tileStatsOverlay",initialValue:()=>M.statsTiles,onChange:e=>{M.statsTiles=e,e&&b()},urlParam:!0},{panel:g,header:c.stats,setting:"textureStatsOverlay",initialValue:()=>M.statsTextures,onChange:e=>{M.statsTextures=e,e&&b()},urlParam:!0},{panel:g,header:c.stats,setting:"textureStreamingOverlay",initialValue:()=>M.statsTextureStream,onChange:e=>{M.statsTextureStream=e,e&&b()},urlParam:!0}],w=[{panel:g,header:c.log,buttonName:"Log: App State",callback:()=>{y.warn(o),y.warn(n),y.warn(s),y.warn(t)}}];d&&(M.hideMenu||await(0,h.c)(1e3).then((()=>{t.getSettingsGui().loadGuiPackage().then((()=>{t.getSettingsGui().toggle(t.getMainPanelId()),t.getSettingsGui().toggle(t.getMainPanelId())}))})),await(0,h.c)(16),S||(await(0,h.c)(16),S=!0,function(e,t,n,i){const r=[{panel:e,header:t.tile,setting:"smallMeshThreshold",initialValue:()=>f.smallMeshThreshold,onChange:e=>{f.smallMeshThreshold=e,i.forEach((t=>{t.modelMesh.settings.smallMeshThreshold=e}))},range:[0,100],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile,setting:"smallMeshErrorMultiplier",initialValue:()=>f.smallMeshErrorMultiplier,onChange:e=>{f.smallMeshErrorMultiplier=e,i.forEach((t=>{t.modelMesh.settings.smallMeshErrorMultiplier=e}))},range:[.01,2],rangePrecision:2,urlParam:!0},{panel:e,header:t.tile,setting:"displayActiveTiles",initialValue:()=>f.displayActiveTiles,onChange:e=>{f.displayActiveTiles=e,i.forEach((t=>{t.modelMesh.settings.displayActiveTiles=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"loadSiblings",initialValue:()=>f.loadSiblings,onChange:e=>{f.loadSiblings=e,i.forEach((t=>{t.modelMesh.settings.loadSiblings=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"autoDisableRendererCulling",initialValue:()=>f.autoDisableRendererCulling,onChange:e=>{f.autoDisableRendererCulling=e,i.forEach((t=>{t.modelMesh.settings.autoDisableRendererCulling=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"stopAtEmptyTiles",initialValue:()=>f.stopAtEmptyTiles,onChange:e=>{f.stopAtEmptyTiles=e,i.forEach((t=>{t.modelMesh.settings.stopAtEmptyTiles=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"limitMemoryUsage",initialValue:()=>f.limitMemoryUsage,onChange:e=>{f.limitMemoryUsage=e,i.forEach((t=>{t.modelMesh.settings.limitMemoryUsage=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"allocatedMegsBeforeLimitingLod",initialValue:()=>f.allocatedMegsBeforeLimitingLod,onChange:e=>{f.allocatedMegsBeforeLimitingLod=e,i.forEach((t=>{t.modelMesh.settings.allocatedMegsBeforeLimitingLod=e}))},urlParam:!0,range:[100,1e3]},{panel:e,header:t.tile,setting:"lruMinExtraTiles",initialValue:()=>f.lruMinExtraTiles,onChange:e=>{f.lruMinExtraTiles=e,i.forEach((t=>{t.modelMesh.settings.lruMinExtraTiles=e}))},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruMaxTiles",initialValue:()=>f.lruMaxTiles,onChange:e=>{f.lruMaxTiles=e,i.forEach((t=>{t.modelMesh.settings.lruMaxTiles=e}))},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruUnloadPercent",initialValue:()=>f.lruUnloadPercent,onChange:e=>{f.lruUnloadPercent=e,i.forEach((t=>{t.modelMesh.settings.lruUnloadPercent=e}))},urlParam:!0,range:[0,1]},{panel:e,header:"Priority",setting:"errorMultiplierRaycastOcclusion",initialValue:()=>f.errorMultiplierRaycastOcclusion,onChange:e=>{f.errorMultiplierRaycastOcclusion=e,i.forEach((t=>{t.modelMesh.settings.errorMultiplierRaycastOcclusion=e}))},range:[.001,1],rangePrecision:2},{panel:e,header:"Priority",setting:"errorMultiplierHiddenFloors",initialValue:()=>f.errorMultiplierHiddenFloors,onChange:e=>{f.errorMultiplierHiddenFloors=e,i.forEach((t=>{t.modelMesh.settings.errorMultiplierHiddenFloors=e}))},range:[.001,1],rangePrecision:2}];return r}(g,c,0,o).forEach((e=>t.registerMenuEntry(e))),E.forEach((e=>t.registerMenuEntry(e))),w.forEach((e=>t.registerMenuButton(e)))))}function B(e,t,n){let i=!1;const r=e=>{t.after(a.R.End).then((()=>{e.forEach((e=>{e&&n(e,i)}))}))},s=e.notifyOnChunksLoaded(r);s.cancel();return{toggle:t=>{t?s.renew():s.cancel(),t!==i&&(i=t,r([...e.container.chunks]))},colorize:r,subscription:s}}const P={0:new i.Vector4(1,0,0,1),1:new i.Vector4(0,1,0,1),2:new i.Vector4(0,0,1,1),3:new i.Vector4(1,1,1,1),4:new i.Vector4(1,0,1,1),5:new i.Vector4(0,1,1,1),6:new i.Vector4(1,1,0,1),7:new i.Vector4(0,0,0,1)};function k(e,t,n){var r,s;const a=null!==(s=null===(r=P[e])||void 0===r?void 0:r.clone())&&void 0!==s?s:new i.Vector4;return a.multiplyScalar(t),a.setW(n),a}const O=C},15564:(e,t,n)=>{n.d(t,{F:()=>i});const i={TITLE:"streamed-mesh (T)",HOTKEYS:[n(71397).D.T]}},99276:(e,t,n)=>{n.d(t,{B:()=>u});var i=n(68909),r=n(36476),s=n(30443),a=n(37458),o=n(5984),l=n(47299);class u extends o.r{constructor(e,t,n=r.H.ALL){super(),this._opacity=1,this._chunks=[],this.size=new i.Vector3,this.center=new i.Vector3,this.built=!1,this.layers.mask=n.mask,this.name=`RoomMesh:${e}-${t}`,this.meshGroup=e,this.meshSubgroup=t,this.renderOrder=a.X.default,this.castShadow=u.ShouldCastShadow,this.onBeforeRender=(e,t,n,i,r,s)=>{this.updateUniforms(r,s)}}dispose(){this.reset()}reset(){this._chunks.length=0,this.geometry.dispose(),delete this.onBuild,delete this.onOpacityUpdate,this.built=!1}addChunk(e){-1===this._chunks.indexOf(e)&&this._chunks.push(e)}getChunk(e){return this._chunks[e]}build(){if(this.built)throw new Error("build() should only be called once");if(!this._chunks.length)return;const e=(0,s.h0)(this._chunks.map((e=>e.geometry)));e.clearGroups();let t=0;this.material=[],this._chunks.forEach(((n,i)=>{n.geometry&&n.geometry.index&&(e.addGroup(t,n.geometry.index.count,i),t+=n.geometry.index.count,n.geometry.dispose(),n.geometry=e,n.notifyOnMaterialUpdated((e=>{Array.isArray(this.material)&&(this.material[i]=e),this.onMaterialUpdate&&this.onMaterialUpdate()})),n.onOpacityUpdate=e=>{this.opacity=e})})),this.geometry=e,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.material=this._chunks.map((e=>e.material)),this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0,this.onBuild&&this.onBuild()}buildWithSingleChunk(e){if(this.built)return;const{meshGroup:t,meshSubgroup:n,lod:i}=e;this.name=`RoomMesh:${i}-${t}-${n}-${e.chunkIndex}`,this.meshGroup=t,this.meshSubgroup=n,this._chunks.push(e),e.notifyOnMaterialUpdated((e=>{this.material=e,this.onMaterialUpdate&&this.onMaterialUpdate()})),e.onOpacityUpdate=e=>{this.opacity=e},this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0,this.onBuild&&this.onBuild()}updateUniforms(e,t){e instanceof i.ShaderMaterial&&(t?this.chunks[t.materialIndex].onBeforeDraw(e):this.chunks.length&&this.chunks[0].onBeforeDraw(e))}get boundingBox(){return(0,s.UX)(this.geometry)}set opacity(e){e!==this.opacity&&(this._opacity=e,this.raycastEnabled=e>l.u7.FADE_CLICKABLE_THRESHOLD,this.renderOrder=e<l.u7.FADE_OPAQUE?a.X.ghostFloor:a.X.default,this.onOpacityUpdate&&this.onOpacityUpdate(e))}get opacity(){return this._opacity}get chunks(){return this._chunks}getSortKey(){return this.chunks.length?this._chunks[0].getSortKey():0}}u.ShouldCastShadow=!1},32484:(e,t,n)=>{n.d(t,{yJ:()=>a});var i=n(80112),r=n(47299),s=n(14971);const a={TEXTURE_SETTINGS:r.Ay,TILEDMESH_SETTINGS:i.W,clearRaycastHits:s.Jn}},83075:(e,t,n)=>{n.d(t,{PO:()=>r,m2:()=>s});var i=n(99276);const r=e=>!!e&&e instanceof i.B,s={hasMeshGroup:e=>"object"==typeof e&&!!e&&"meshGroup"in e,hasMeshSubgroup:e=>"object"==typeof e&&!!e&&"meshSubgroup"in e,isRoomMesh:r,isVisibleRoomMesh:e=>r(e)&&e.raycastEnabled&&e.visible}},30443:(e,t,n)=>{n.d(t,{U7:()=>u,UX:()=>l,Wi:()=>d,h0:()=>s,jF:()=>g,nD:()=>c});var i=n(68909),r=n(81662);function s(e){if(0===e.length)throw Error("Can't merge empty list of geometries");if(1===e.length)return e[0];let t=0,n=0,r=0,s=0;const o=new i.Box3;for(const i of e)i.index&&(t+=i.index.count,n+=i.getAttribute("position").count,i.getAttribute("uv")&&(r+=i.getAttribute("uv").count),i.boundingBox&&(o.union(i.boundingBox),s++));const u=new i.BufferGeometry;s!==e.length||o.isEmpty()?u.computeBoundingBox():u.boundingBox=o,o.copy(l(u)),u.boundingSphere=o.getBoundingSphere(new i.Sphere);const h=a(new Float32Array(3*n),"position",e);u.setAttribute("position",new i.BufferAttribute(h,3));const d=function(e,t){let n=0,i=0;for(const r of t){const t=r.index;for(let r=0;r<t.array.length;r++)e[n+r]=t.array[r]+i;n+=t.array.length,i+=r.getAttribute("position").count}return e}(new Uint32Array(t),e);if(u.setIndex(new i.BufferAttribute(d,1)),r){const t=a(new Float32Array(2*r),"uv",e);u.setAttribute("uv",new i.BufferAttribute(t,2))}return u}function a(e,t,n){let i=0;for(const r of n){const n=r.getAttribute(t);e.set(n.array,i),i+=n.array.length}return e}const o=new i.Box3(r.B1.ZERO,r.B1.UNIT);function l(e){return e.boundingBox||e.computeBoundingBox(),e.boundingBox||o}function u(e,t){let n=1/0;const r=t.clone(),s=new i.Vector3,a=new i.Vector3(1/0,1/0,1/0);let o=-1;const l=new i.Triangle;return function(e,t){var n;const i=null===(n=e.index)||void 0===n?void 0:n.array,r=e.getAttribute("position");if(!r)return;const s=e.groups.length>0?e.groups:[{start:0,count:i?i.length:r.count,materialIndex:0}];let a=0;for(const e of s)for(let n=e.start;n<e.start+e.count;n+=3){let s=n,o=n+1,l=n+2;i&&(s=i[s],o=i[o],l=i[l]),t(r.getX(s),r.getY(s),r.getZ(s),r.getX(o),r.getY(o),r.getZ(o),r.getX(l),r.getY(l),r.getZ(l),a++,e.materialIndex||0)}}(e,((e,t,i,u,h,d,g,c,m,p)=>{l.a.set(e,t,i),l.b.set(u,h,d),l.c.set(g,c,m),l.closestPointToPoint(r,s);const y=r.distanceToSquared(s);y<n&&(a.copy(s),n=y,o=p)})),{point:a,distance:Math.sqrt(n),faceIndex:o}}const h=new i.PlaneGeometry(1,1);function d(){return h}const g=(e,t)=>{t=t||[];for(let e=0;e<8;e++)t[e]=t[e]||new i.Vector3;return t[0].set(e.min.x,e.min.y,e.min.z),t[1].set(e.min.x,e.max.y,e.min.z),t[2].set(e.max.x,e.max.y,e.min.z),t[3].set(e.max.x,e.min.y,e.min.z),t[4].set(e.min.x,e.min.y,e.max.z),t[5].set(e.min.x,e.max.y,e.max.z),t[6].set(e.max.x,e.max.y,e.max.z),t[7].set(e.max.x,e.min.y,e.max.z),t},c=(()=>{const e=new i.Vector3,t=new i.Vector3;return(n,r,s)=>{r=r||new i.Box3,e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(const i of n)s&&i.applyMatrix4(s),e.x=Math.min(e.x,i.x),e.y=Math.min(e.y,i.y),e.z=Math.min(e.z,i.z),t.x=Math.max(t.x,i.x),t.y=Math.max(t.y,i.y),t.z=Math.max(t.z,i.z);return r.min.copy(e),r.max.copy(t),r}})()}}]);