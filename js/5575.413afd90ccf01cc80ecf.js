"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[5575],{99276:(e,t,n)=>{n.d(t,{B:()=>c});var r=n(68909),o=n(36476),i=n(30443),s=n(37458),u=n(5984),a=n(47299);class c extends u.r{constructor(e,t,n=o.H.ALL){super(),this._opacity=1,this._chunks=[],this.size=new r.Vector3,this.center=new r.Vector3,this.built=!1,this.layers.mask=n.mask,this.name=`RoomMesh:${e}-${t}`,this.meshGroup=e,this.meshSubgroup=t,this.renderOrder=s.X.default,this.castShadow=c.ShouldCastShadow,this.onBeforeRender=(e,t,n,r,o,i)=>{this.updateUniforms(o,i)}}dispose(){this.reset()}reset(){this._chunks.length=0,this.geometry.dispose(),delete this.onBuild,delete this.onOpacityUpdate,this.built=!1}addChunk(e){-1===this._chunks.indexOf(e)&&this._chunks.push(e)}getChunk(e){return this._chunks[e]}build(){if(this.built)throw new Error("build() should only be called once");if(!this._chunks.length)return;const e=(0,i.h0)(this._chunks.map((e=>e.geometry)));e.clearGroups();let t=0;this.material=[],this._chunks.forEach(((n,r)=>{n.geometry&&n.geometry.index&&(e.addGroup(t,n.geometry.index.count,r),t+=n.geometry.index.count,n.geometry.dispose(),n.geometry=e,n.notifyOnMaterialUpdated((e=>{Array.isArray(this.material)&&(this.material[r]=e),this.onMaterialUpdate&&this.onMaterialUpdate()})),n.onOpacityUpdate=e=>{this.opacity=e})})),this.geometry=e,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.material=this._chunks.map((e=>e.material)),this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0,this.onBuild&&this.onBuild()}buildWithSingleChunk(e){if(this.built)return;const{meshGroup:t,meshSubgroup:n,lod:r}=e;this.name=`RoomMesh:${r}-${t}-${n}-${e.chunkIndex}`,this.meshGroup=t,this.meshSubgroup=n,this._chunks.push(e),e.notifyOnMaterialUpdated((e=>{this.material=e,this.onMaterialUpdate&&this.onMaterialUpdate()})),e.onOpacityUpdate=e=>{this.opacity=e},this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0,this.onBuild&&this.onBuild()}updateUniforms(e,t){e instanceof r.ShaderMaterial&&(t?this.chunks[t.materialIndex].onBeforeDraw(e):this.chunks.length&&this.chunks[0].onBeforeDraw(e))}get boundingBox(){return(0,i.UX)(this.geometry)}set opacity(e){e!==this.opacity&&(this._opacity=e,this.raycastEnabled=e>a.u7.FADE_CLICKABLE_THRESHOLD,this.renderOrder=e<a.u7.FADE_OPAQUE?s.X.ghostFloor:s.X.default,this.onOpacityUpdate&&this.onOpacityUpdate(e))}get opacity(){return this._opacity}get chunks(){return this._chunks}getSortKey(){return this.chunks.length?this._chunks[0].getSortKey():0}}c.ShouldCastShadow=!1},3694:(e,t,n)=>{n.d(t,{W:()=>o});var r=n(68909);class o extends r.Mesh{}},78229:(e,t,n)=>{n.d(t,{AU:()=>s,DJ:()=>y,Eo:()=>m,GS:()=>c,OX:()=>d,Ol:()=>f,Pi:()=>g,Zx:()=>h,Zz:()=>_,f:()=>a,fm:()=>x,jW:()=>p,lp:()=>b,sT:()=>l,xg:()=>u});var r=n(50018),o=n(68909);const i=.25,s=e=>{function t(t){return t!==e}return Object.defineProperty(t,"name",{value:"_not"}),t},u=e=>{function t(t){return!!e.neighbours&&(-1!==e.neighbours.indexOf(t.id)||-1!==e.neighbours.indexOf(t.platformId))}return Object.defineProperty(t,"name",{value:"_neighbor"}),t},a=e=>{function t(t){return e===t||u(e)(t)}return Object.defineProperty(t,"name",{value:"_neighborOrSelf"}),t};function c(e){return e&&e.placementType===r.EO.MANUAL}function h(){function e(e){return e&&e.alignmentType===r.c$.ALIGNED}return Object.defineProperty(e,"name",{value:"_aligned"}),e}const d=()=>{function e(e){return e&&e.alignmentType!==r.c$.ALIGNED}return Object.defineProperty(e,"name",{value:"_unaligned"}),e},l=e=>{function t(t){return t&&e.floorId===t.floorId}return Object.defineProperty(t,"name",{value:"_sameFloor"}),t},m=e=>{function t(t){return t&&e===t.floorId}return Object.defineProperty(t,"name",{value:"_onFloor"}),t},p=(()=>{const e=new o.Vector3,t=new o.Vector3;return(n,r,o=i)=>{function s(i){return e.copy(i.position).sub(n).normalize().dot(t.copy(r))>o}return Object.defineProperty(s,"name",{value:"_inDirection"}),s}})(),f=()=>{function e(e){return e&&e.enabled}return Object.defineProperty(e,"name",{value:"_enabled"}),e},y=(e,t)=>{const n=new o.Vector3;function r(r){return n.copy(r.position).sub(e).normalize().dot(t)>0}return t=t.clone(),Object.defineProperty(r,"name",{value:"_byNormal"}),r},g=(e,t)=>{function n(n){return e.distanceTo(n.position)>t}return Object.defineProperty(n,"name",{value:"_outsideMaxDist"}),n},b=(e,t)=>{function n(n){return e.distanceTo(n.position)<t}return Object.defineProperty(n,"name",{value:"_inMaxDist"}),n},x=(e,t)=>{function n(n){return e.distanceToSquared(n.position)<t}return Object.defineProperty(n,"name",{value:"_inMaxSqDist"}),n},_={negate:e=>function(t){return!e.call(e,t)},every:(...e)=>function(t){return e.every((e=>e(t)))},some:(...e)=>function(t){return e.some((e=>e(t)))}}},96659:(e,t,n)=>{n.d(t,{Io:()=>u,VY:()=>c,cv:()=>h,d$:()=>s,oW:()=>a});var r=n(68909);const o=-1,i=10,s=(e,t=o)=>{function n(n){return e.distanceToSquared(n.position)*t}return Object.defineProperty(n,"name",{value:"_distanceSq"}),n},u=(e,t=o)=>{function n(n){return e.distanceTo(n.position)*t}return Object.defineProperty(n,"name",{value:"_distance"}),n},a=(e,t,n=i)=>{const o=new r.Vector3;function s(r){return o.copy(r.position).sub(e).normalize().dot(t)*n}return Object.defineProperty(s,"name",{value:"_direction"}),s},c=(e,t,n=i)=>{const o=new r.Vector3;function s(r){return o.copy(r.position).sub(e).normalize().dot(t)*n}return Object.defineProperty(s,"name",{value:"_viewDirNorm"}),s},h=(e,t=o)=>{function n(n){return e.distanceToSquared(n.floorPosition)*t}return Object.defineProperty(n,"name",{value:"_floorDistSq"}),n}},30443:(e,t,n)=>{n.d(t,{U7:()=>c,UX:()=>a,Wi:()=>d,h0:()=>i,jF:()=>l,nD:()=>m});var r=n(68909),o=n(81662);function i(e){if(0===e.length)throw Error("Can't merge empty list of geometries");if(1===e.length)return e[0];let t=0,n=0,o=0,i=0;const u=new r.Box3;for(const r of e)r.index&&(t+=r.index.count,n+=r.getAttribute("position").count,r.getAttribute("uv")&&(o+=r.getAttribute("uv").count),r.boundingBox&&(u.union(r.boundingBox),i++));const c=new r.BufferGeometry;i!==e.length||u.isEmpty()?c.computeBoundingBox():c.boundingBox=u,u.copy(a(c)),c.boundingSphere=u.getBoundingSphere(new r.Sphere);const h=s(new Float32Array(3*n),"position",e);c.setAttribute("position",new r.BufferAttribute(h,3));const d=function(e,t){let n=0,r=0;for(const o of t){const t=o.index;for(let o=0;o<t.array.length;o++)e[n+o]=t.array[o]+r;n+=t.array.length,r+=o.getAttribute("position").count}return e}(new Uint32Array(t),e);if(c.setIndex(new r.BufferAttribute(d,1)),o){const t=s(new Float32Array(2*o),"uv",e);c.setAttribute("uv",new r.BufferAttribute(t,2))}return c}function s(e,t,n){let r=0;for(const o of n){const n=o.getAttribute(t);e.set(n.array,r),r+=n.array.length}return e}const u=new r.Box3(o.B1.ZERO,o.B1.UNIT);function a(e){return e.boundingBox||e.computeBoundingBox(),e.boundingBox||u}function c(e,t){let n=1/0;const o=t.clone(),i=new r.Vector3,s=new r.Vector3(1/0,1/0,1/0);let u=-1;const a=new r.Triangle;return function(e,t){var n;const r=null===(n=e.index)||void 0===n?void 0:n.array,o=e.getAttribute("position");if(!o)return;const i=e.groups.length>0?e.groups:[{start:0,count:r?r.length:o.count,materialIndex:0}];let s=0;for(const e of i)for(let n=e.start;n<e.start+e.count;n+=3){let i=n,u=n+1,a=n+2;r&&(i=r[i],u=r[u],a=r[a]),t(o.getX(i),o.getY(i),o.getZ(i),o.getX(u),o.getY(u),o.getZ(u),o.getX(a),o.getY(a),o.getZ(a),s++,e.materialIndex||0)}}(e,((e,t,r,c,h,d,l,m,p,f)=>{a.a.set(e,t,r),a.b.set(c,h,d),a.c.set(l,m,p),a.closestPointToPoint(o,i);const y=o.distanceToSquared(i);y<n&&(s.copy(i),n=y,u=f)})),{point:s,distance:Math.sqrt(n),faceIndex:u}}const h=new r.PlaneGeometry(1,1);function d(){return h}const l=(e,t)=>{t=t||[];for(let e=0;e<8;e++)t[e]=t[e]||new r.Vector3;return t[0].set(e.min.x,e.min.y,e.min.z),t[1].set(e.min.x,e.max.y,e.min.z),t[2].set(e.max.x,e.max.y,e.min.z),t[3].set(e.max.x,e.min.y,e.min.z),t[4].set(e.min.x,e.min.y,e.max.z),t[5].set(e.min.x,e.max.y,e.max.z),t[6].set(e.max.x,e.max.y,e.max.z),t[7].set(e.max.x,e.min.y,e.max.z),t},m=(()=>{const e=new r.Vector3,t=new r.Vector3;return(n,o,i)=>{o=o||new r.Box3,e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(const r of n)i&&r.applyMatrix4(i),e.x=Math.min(e.x,r.x),e.y=Math.min(e.y,r.y),e.z=Math.min(e.z,r.z),t.x=Math.max(t.x,r.x),t.y=Math.max(t.y,r.y),t.z=Math.max(t.z,r.z);return o.min.copy(e),o.max.copy(t),o}})()}}]);